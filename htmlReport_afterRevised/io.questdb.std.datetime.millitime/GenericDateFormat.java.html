<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GenericDateFormat.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">All in questdb Coverage Results</a> &gt; <a href="index.source.html" class="el_package">io.questdb.std.datetime.millitime</a> &gt; <span class="el_source">GenericDateFormat.java</span></div><h1>GenericDateFormat.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 *     ___                  _   ____  ____
 *    / _ \ _   _  ___  ___| |_|  _ \| __ )
 *   | | | | | | |/ _ \/ __| __| | | |  _ \
 *   | |_| | |_| |  __/\__ \ |_| |_| | |_) |
 *    \__\_\\__,_|\___||___/\__|____/|____/
 *
 *  Copyright (c) 2014-2019 Appsicle
 *  Copyright (c) 2019-2022 QuestDB
 *
 *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 ******************************************************************************/

package io.questdb.std.datetime.millitime;

import io.questdb.std.IntList;
import io.questdb.std.Numbers;
import io.questdb.std.NumericException;
import io.questdb.std.ObjList;
import io.questdb.std.datetime.AbstractDateFormat;
import io.questdb.std.datetime.DateLocale;
import io.questdb.std.datetime.microtime.TimestampFormatUtils;
import io.questdb.std.str.CharSink;

public class GenericDateFormat extends AbstractDateFormat {
    private final IntList compiledOps;
    private final ObjList&lt;String&gt; delimiters;

<span class="fc" id="L40">    public GenericDateFormat(IntList compiledOps, ObjList&lt;String&gt; delimiters) {</span>
<span class="fc" id="L41">        this.compiledOps = compiledOps;</span>
<span class="fc" id="L42">        this.delimiters = delimiters;</span>
<span class="fc" id="L43">    }</span>

    @Override
    public void format(long datetime, DateLocale locale, CharSequence timeZoneName, CharSink sink) {
<span class="fc" id="L47">        int day = -1;</span>
<span class="fc" id="L48">        int month = -1;</span>
<span class="fc" id="L49">        int year = Integer.MIN_VALUE;</span>
<span class="fc" id="L50">        int hour = -1;</span>
<span class="fc" id="L51">        int minute = -1;</span>
<span class="fc" id="L52">        int second = -1;</span>
<span class="fc" id="L53">        int dayOfWeek = -1;</span>
<span class="fc" id="L54">        int dayOfYear = -1;</span>
<span class="fc" id="L55">        boolean leap = false;</span>
<span class="fc" id="L56">        int millis = -1;</span>

<span class="fc bfc" id="L58" title="All 2 branches covered.">        for (int i = 0, n = compiledOps.size(); i &lt; n; i++) {</span>
<span class="fc" id="L59">            int op = compiledOps.getQuick(i);</span>
<span class="fc bfc" id="L60" title="All 34 branches covered.">            switch (op) {</span>

                // AM/PM
                case DateFormatCompiler.OP_AM_PM:
<span class="pc bpc" id="L64" title="1 of 2 branches missed.">                    if (hour == -1) {</span>
<span class="fc" id="L65">                        hour = Dates.getHourOfDay(datetime);</span>
                    }
<span class="fc" id="L67">                    DateFormatUtils.appendAmPm(sink, hour, locale);</span>
<span class="fc" id="L68">                    break;</span>

                // MILLIS
                case DateFormatCompiler.OP_MILLIS_ONE_DIGIT:
                case DateFormatCompiler.OP_MILLIS_GREEDY:
<span class="pc bpc" id="L73" title="1 of 2 branches missed.">                    if (millis == -1) {</span>
<span class="fc" id="L74">                        millis = Dates.getMillisOfSecond(datetime);</span>
                    }
<span class="fc" id="L76">                    sink.put(millis);</span>
<span class="fc" id="L77">                    break;</span>

                case DateFormatCompiler.OP_MILLIS_THREE_DIGITS:
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">                    if (millis == -1) {</span>
<span class="fc" id="L81">                        millis = Dates.getMillisOfSecond(datetime);</span>
                    }
<span class="fc" id="L83">                    DateFormatUtils.append00(sink, millis);</span>
<span class="fc" id="L84">                    break;</span>

                // SECOND
                case DateFormatCompiler.OP_SECOND_ONE_DIGIT:
                case DateFormatCompiler.OP_SECOND_GREEDY:
<span class="pc bpc" id="L89" title="1 of 2 branches missed.">                    if (second == -1) {</span>
<span class="fc" id="L90">                        second = Dates.getSecondOfMinute(datetime);</span>
                    }
<span class="fc" id="L92">                    sink.put(second);</span>
<span class="fc" id="L93">                    break;</span>

                case DateFormatCompiler.OP_SECOND_TWO_DIGITS:
<span class="pc bpc" id="L96" title="1 of 2 branches missed.">                    if (second == -1) {</span>
<span class="fc" id="L97">                        second = Dates.getSecondOfMinute(datetime);</span>
                    }
<span class="fc" id="L99">                    DateFormatUtils.append0(sink, second);</span>
<span class="fc" id="L100">                    break;</span>


                // MINUTE
                case DateFormatCompiler.OP_MINUTE_ONE_DIGIT:
                case DateFormatCompiler.OP_MINUTE_GREEDY:
<span class="pc bpc" id="L106" title="1 of 2 branches missed.">                    if (minute == -1) {</span>
<span class="fc" id="L107">                        minute = Dates.getMinuteOfHour(datetime);</span>
                    }
<span class="fc" id="L109">                    sink.put(minute);</span>
<span class="fc" id="L110">                    break;</span>

                case DateFormatCompiler.OP_MINUTE_TWO_DIGITS:
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">                    if (minute == -1) {</span>
<span class="fc" id="L114">                        minute = Dates.getMinuteOfHour(datetime);</span>
                    }
<span class="fc" id="L116">                    DateFormatUtils.append0(sink, minute);</span>
<span class="fc" id="L117">                    break;</span>


                // HOUR (0-11)
                case DateFormatCompiler.OP_HOUR_12_ONE_DIGIT:
                case DateFormatCompiler.OP_HOUR_12_GREEDY:
<span class="fc bfc" id="L123" title="All 2 branches covered.">                    if (hour == -1) {</span>
<span class="fc" id="L124">                        hour = Dates.getHourOfDay(datetime);</span>
                    }
<span class="fc" id="L126">                    DateFormatUtils.appendHour12(sink, hour);</span>
<span class="fc" id="L127">                    break;</span>

                case DateFormatCompiler.OP_HOUR_12_TWO_DIGITS:
<span class="fc bfc" id="L130" title="All 2 branches covered.">                    if (hour == -1) {</span>
<span class="fc" id="L131">                        hour = Dates.getHourOfDay(datetime);</span>
                    }
<span class="fc" id="L133">                    DateFormatUtils.appendHour12Padded(sink, hour);</span>
<span class="fc" id="L134">                    break;</span>

                // HOUR (1-12)
                case DateFormatCompiler.OP_HOUR_12_ONE_DIGIT_ONE_BASED:
                case DateFormatCompiler.OP_HOUR_12_GREEDY_ONE_BASED:
<span class="fc bfc" id="L139" title="All 2 branches covered.">                    if (hour == -1) {</span>
<span class="fc" id="L140">                        hour = Dates.getHourOfDay(datetime);</span>
                    }
<span class="fc" id="L142">                    DateFormatUtils.appendHour121(sink, hour);</span>
<span class="fc" id="L143">                    break;</span>

                case DateFormatCompiler.OP_HOUR_12_TWO_DIGITS_ONE_BASED:
<span class="fc bfc" id="L146" title="All 2 branches covered.">                    if (hour == -1) {</span>
<span class="fc" id="L147">                        hour = Dates.getHourOfDay(datetime);</span>
                    }
<span class="fc" id="L149">                    DateFormatUtils.appendHour121Padded(sink, hour);</span>
<span class="fc" id="L150">                    break;</span>

                // HOUR (0-23)
                case DateFormatCompiler.OP_HOUR_24_ONE_DIGIT:
                case DateFormatCompiler.OP_HOUR_24_GREEDY:
<span class="fc bfc" id="L155" title="All 2 branches covered.">                    if (hour == -1) {</span>
<span class="fc" id="L156">                        hour = Dates.getHourOfDay(datetime);</span>
                    }
<span class="fc" id="L158">                    sink.put(hour);</span>
<span class="fc" id="L159">                    break;</span>

                case DateFormatCompiler.OP_HOUR_24_TWO_DIGITS:
<span class="fc bfc" id="L162" title="All 2 branches covered.">                    if (hour == -1) {</span>
<span class="fc" id="L163">                        hour = Dates.getHourOfDay(datetime);</span>
                    }
<span class="fc" id="L165">                    DateFormatUtils.append0(sink, hour);</span>
<span class="fc" id="L166">                    break;</span>

                // HOUR (1 - 24)
                case DateFormatCompiler.OP_HOUR_24_ONE_DIGIT_ONE_BASED:
                case DateFormatCompiler.OP_HOUR_24_GREEDY_ONE_BASED:
<span class="fc bfc" id="L171" title="All 2 branches covered.">                    if (hour == -1) {</span>
<span class="fc" id="L172">                        hour = Dates.getHourOfDay(datetime);</span>
                    }
<span class="fc" id="L174">                    sink.put(hour + 1);</span>
<span class="fc" id="L175">                    break;</span>

                case DateFormatCompiler.OP_HOUR_24_TWO_DIGITS_ONE_BASED:
<span class="fc bfc" id="L178" title="All 2 branches covered.">                    if (hour == -1) {</span>
<span class="fc" id="L179">                        hour = Dates.getHourOfDay(datetime);</span>
                    }
<span class="fc" id="L181">                    DateFormatUtils.append0(sink, hour + 1);</span>
<span class="fc" id="L182">                    break;</span>

                // DAY
                case DateFormatCompiler.OP_DAY_ONE_DIGIT:
                case DateFormatCompiler.OP_DAY_GREEDY:
<span class="pc bpc" id="L187" title="1 of 2 branches missed.">                    if (day == -1) {</span>
<span class="pc bpc" id="L188" title="1 of 2 branches missed.">                        if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L189">                            year = Dates.getYear(datetime);</span>
<span class="fc" id="L190">                            leap = Dates.isLeapYear(year);</span>
                        }

<span class="pc bpc" id="L193" title="1 of 2 branches missed.">                        if (month == -1) {</span>
<span class="fc" id="L194">                            month = Dates.getMonthOfYear(datetime, year, leap);</span>
                        }

<span class="fc" id="L197">                        day = Dates.getDayOfMonth(datetime, year, month, leap);</span>
                    }
<span class="fc" id="L199">                    sink.put(day);</span>
<span class="fc" id="L200">                    break;</span>
                case DateFormatCompiler.OP_DAY_TWO_DIGITS:
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">                    if (day == -1) {</span>
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">                        if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L204">                            year = Dates.getYear(datetime);</span>
<span class="fc" id="L205">                            leap = Dates.isLeapYear(year);</span>
                        }

<span class="pc bpc" id="L208" title="1 of 2 branches missed.">                        if (month == -1) {</span>
<span class="fc" id="L209">                            month = Dates.getMonthOfYear(datetime, year, leap);</span>
                        }

<span class="fc" id="L212">                        day = Dates.getDayOfMonth(datetime, year, month, leap);</span>
                    }
<span class="fc" id="L214">                    DateFormatUtils.append0(sink, day);</span>
<span class="fc" id="L215">                    break;</span>

                case DateFormatCompiler.OP_DAY_NAME_LONG:
<span class="pc bpc" id="L218" title="1 of 2 branches missed.">                    if (dayOfWeek == -1) {</span>
<span class="fc" id="L219">                        dayOfWeek = Dates.getDayOfWeekSundayFirst(datetime);</span>
                    }
<span class="fc" id="L221">                    sink.put(locale.getWeekday(dayOfWeek));</span>
<span class="fc" id="L222">                    break;</span>

                case DateFormatCompiler.OP_DAY_NAME_SHORT:
<span class="pc bpc" id="L225" title="1 of 2 branches missed.">                    if (dayOfWeek == -1) {</span>
<span class="fc" id="L226">                        dayOfWeek = Dates.getDayOfWeekSundayFirst(datetime);</span>
                    }
<span class="fc" id="L228">                    sink.put(locale.getShortWeekday(dayOfWeek));</span>
<span class="fc" id="L229">                    break;</span>

                case DateFormatCompiler.OP_DAY_OF_WEEK:
<span class="pc bpc" id="L232" title="1 of 2 branches missed.">                    if (dayOfWeek == -1) {</span>
<span class="fc" id="L233">                        dayOfWeek = Dates.getDayOfWeekSundayFirst(datetime);</span>
                    }
<span class="fc" id="L235">                    sink.put(dayOfWeek);</span>
<span class="fc" id="L236">                    break;</span>
                case DateFormatCompiler.OP_DAY_OF_YEAR:
<span class="pc bpc" id="L238" title="1 of 2 branches missed.">                    if (dayOfYear == -1) {</span>
<span class="fc" id="L239">                        dayOfYear = Dates.getDayOfYear(datetime);</span>
                    }
<span class="fc" id="L241">                    sink.put(dayOfYear);</span>
<span class="fc" id="L242">                    break;</span>
                case DateFormatCompiler.OP_WEEK_OF_YEAR:
<span class="fc" id="L244">                    sink.put(Dates.getWeekOfYear(datetime));</span>
<span class="fc" id="L245">                    break;</span>
                case DateFormatCompiler.OP_WEEK_OF_MONTH:
<span class="fc" id="L247">                    sink.put(Dates.getWeekOfMonth(datetime));</span>
<span class="fc" id="L248">                    break;</span>

                // MONTH

                case DateFormatCompiler.OP_MONTH_ONE_DIGIT:
                case DateFormatCompiler.OP_MONTH_GREEDY:
<span class="fc bfc" id="L254" title="All 2 branches covered.">                    if (month == -1) {</span>
<span class="pc bpc" id="L255" title="1 of 2 branches missed.">                        if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L256">                            year = Dates.getYear(datetime);</span>
<span class="fc" id="L257">                            leap = Dates.isLeapYear(year);</span>
                        }

<span class="fc" id="L260">                        month = Dates.getMonthOfYear(datetime, year, leap);</span>
                    }
<span class="fc" id="L262">                    sink.put(month);</span>
<span class="fc" id="L263">                    break;</span>
                case DateFormatCompiler.OP_MONTH_TWO_DIGITS:
<span class="fc bfc" id="L265" title="All 2 branches covered.">                    if (month == -1) {</span>
<span class="pc bpc" id="L266" title="1 of 2 branches missed.">                        if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L267">                            year = Dates.getYear(datetime);</span>
<span class="fc" id="L268">                            leap = Dates.isLeapYear(year);</span>
                        }

<span class="fc" id="L271">                        month = Dates.getMonthOfYear(datetime, year, leap);</span>
                    }
<span class="fc" id="L273">                    DateFormatUtils.append0(sink, month);</span>
<span class="fc" id="L274">                    break;</span>

                case DateFormatCompiler.OP_MONTH_SHORT_NAME:
<span class="fc bfc" id="L277" title="All 2 branches covered.">                    if (month == -1) {</span>
<span class="fc bfc" id="L278" title="All 2 branches covered.">                        if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L279">                            year = Dates.getYear(datetime);</span>
<span class="fc" id="L280">                            leap = Dates.isLeapYear(year);</span>
                        }

<span class="fc" id="L283">                        month = Dates.getMonthOfYear(datetime, year, leap);</span>
                    }
<span class="fc" id="L285">                    sink.put(locale.getShortMonth(month - 1));</span>
<span class="fc" id="L286">                    break;</span>
                case DateFormatCompiler.OP_MONTH_LONG_NAME:
<span class="fc bfc" id="L288" title="All 2 branches covered.">                    if (month == -1) {</span>
<span class="pc bpc" id="L289" title="1 of 2 branches missed.">                        if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L290">                            year = Dates.getYear(datetime);</span>
<span class="fc" id="L291">                            leap = Dates.isLeapYear(year);</span>
                        }

<span class="fc" id="L294">                        month = Dates.getMonthOfYear(datetime, year, leap);</span>
                    }
<span class="fc" id="L296">                    sink.put(locale.getMonth(month - 1));</span>
<span class="fc" id="L297">                    break;</span>

                // YEAR

                case DateFormatCompiler.OP_YEAR_ONE_DIGIT:
                case DateFormatCompiler.OP_YEAR_GREEDY:
<span class="fc bfc" id="L303" title="All 2 branches covered.">                    if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L304">                        year = Dates.getYear(datetime);</span>
<span class="fc" id="L305">                        leap = Dates.isLeapYear(year);</span>
                    }
<span class="fc" id="L307">                    sink.put(year);</span>
<span class="fc" id="L308">                    break;</span>
                case DateFormatCompiler.OP_YEAR_TWO_DIGITS:
<span class="fc bfc" id="L310" title="All 2 branches covered.">                    if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L311">                        year = Dates.getYear(datetime);</span>
<span class="fc" id="L312">                        leap = Dates.isLeapYear(year);</span>
                    }
<span class="fc" id="L314">                    DateFormatUtils.append0(sink, year % 100);</span>
<span class="fc" id="L315">                    break;</span>
                case DateFormatCompiler.OP_YEAR_THREE_DIGITS:
<span class="pc bpc" id="L317" title="1 of 2 branches missed.">                    if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L318">                        year = Dates.getYear(datetime);</span>
<span class="fc" id="L319">                        leap = Dates.isLeapYear(year);</span>
                    }
<span class="fc" id="L321">                    DateFormatUtils.append00(sink, year % 1000);</span>
<span class="fc" id="L322">                    break;</span>
                case DateFormatCompiler.OP_YEAR_FOUR_DIGITS:
<span class="fc bfc" id="L324" title="All 2 branches covered.">                    if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L325">                        year = Dates.getYear(datetime);</span>
<span class="fc" id="L326">                        leap = Dates.isLeapYear(year);</span>
                    }
<span class="fc" id="L328">                    TimestampFormatUtils.appendYear000(sink, year);</span>
<span class="fc" id="L329">                    break;</span>

                // ERA
                case DateFormatCompiler.OP_ERA:
<span class="pc bpc" id="L333" title="1 of 2 branches missed.">                    if (year == Integer.MIN_VALUE) {</span>
<span class="fc" id="L334">                        year = Dates.getYear(datetime);</span>
<span class="fc" id="L335">                        leap = Dates.isLeapYear(year);</span>
                    }
<span class="fc" id="L337">                    DateFormatUtils.appendEra(sink, year, locale);</span>
<span class="fc" id="L338">                    break;</span>

                // TIMEZONE
                case DateFormatCompiler.OP_TIME_ZONE_SHORT:
                case DateFormatCompiler.OP_TIME_ZONE_GMT_BASED:
                case DateFormatCompiler.OP_TIME_ZONE_ISO_8601_1:
                case DateFormatCompiler.OP_TIME_ZONE_ISO_8601_2:
                case DateFormatCompiler.OP_TIME_ZONE_ISO_8601_3:
                case DateFormatCompiler.OP_TIME_ZONE_LONG:
                case DateFormatCompiler.OP_TIME_ZONE_RFC_822:
<span class="fc" id="L348">                    sink.put(timeZoneName);</span>
<span class="fc" id="L349">                    break;</span>

                // SEPARATORS
                default:
<span class="fc" id="L353">                    sink.put(delimiters.getQuick(-op - 1));</span>
                    break;
            }
        }
<span class="fc" id="L357">    }</span>

    @Override
    public long parse(CharSequence in, int lo, int hi, DateLocale locale) throws NumericException {
<span class="fc" id="L361">        int day = 1;</span>
<span class="fc" id="L362">        int month = 1;</span>
<span class="fc" id="L363">        int year = 1970;</span>
<span class="fc" id="L364">        int hour = 0;</span>
<span class="fc" id="L365">        int minute = 0;</span>
<span class="fc" id="L366">        int second = 0;</span>
<span class="fc" id="L367">        int millis = 0;</span>
<span class="fc" id="L368">        int era = 1;</span>
<span class="fc" id="L369">        int timezone = -1;</span>
<span class="fc" id="L370">        long offset = Long.MIN_VALUE;</span>
<span class="fc" id="L371">        int hourType = DateFormatUtils.HOUR_24;</span>
<span class="fc" id="L372">        int pos = lo;</span>
        long l;
        int len;

<span class="fc bfc" id="L376" title="All 2 branches covered.">        for (int i = 0, n = compiledOps.size(); i &lt; n; i++) {</span>
<span class="fc" id="L377">            int op = compiledOps.getQuick(i);</span>
<span class="fc bfc" id="L378" title="All 40 branches covered.">            switch (op) {</span>

                // AM/PM
                case DateFormatCompiler.OP_AM_PM:
<span class="fc" id="L382">                    l = locale.matchAMPM(in, pos, hi);</span>
<span class="fc" id="L383">                    hourType = Numbers.decodeLowInt(l);</span>
<span class="fc" id="L384">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L385">                    break;</span>

                // MILLIS
                case DateFormatCompiler.OP_MILLIS_ONE_DIGIT:
<span class="fc" id="L389">                    DateFormatUtils.assertRemaining(pos, hi);</span>
<span class="fc" id="L390">                    millis = Numbers.parseInt(in, pos, ++pos);</span>
<span class="fc" id="L391">                    break;</span>

                case DateFormatCompiler.OP_MILLIS_THREE_DIGITS:
<span class="fc" id="L394">                    DateFormatUtils.assertRemaining(pos + 2, hi);</span>
<span class="fc" id="L395">                    millis = Numbers.parseInt(in, pos, pos += 3);</span>
<span class="fc" id="L396">                    break;</span>

                case DateFormatCompiler.OP_MILLIS_GREEDY:
<span class="fc" id="L399">                    l = Numbers.parseInt000Greedy(in, pos, hi);</span>
<span class="fc" id="L400">                    millis = Numbers.decodeLowInt(l);</span>
<span class="fc" id="L401">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L402">                    break;</span>

                // SECOND
                case DateFormatCompiler.OP_SECOND_ONE_DIGIT:
<span class="fc" id="L406">                    DateFormatUtils.assertRemaining(pos, hi);</span>
<span class="fc" id="L407">                    second = Numbers.parseInt(in, pos, ++pos);</span>
<span class="fc" id="L408">                    break;</span>

                case DateFormatCompiler.OP_SECOND_TWO_DIGITS:
<span class="fc" id="L411">                    DateFormatUtils.assertRemaining(pos + 1, hi);</span>
<span class="fc" id="L412">                    second = Numbers.parseInt(in, pos, pos += 2);</span>
<span class="fc" id="L413">                    break;</span>

                case DateFormatCompiler.OP_SECOND_GREEDY:
<span class="fc" id="L416">                    l = Numbers.parseIntSafely(in, pos, hi);</span>
<span class="fc" id="L417">                    second = Numbers.decodeLowInt(l);</span>
<span class="fc" id="L418">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L419">                    break;</span>

                // MINUTE
                case DateFormatCompiler.OP_MINUTE_ONE_DIGIT:
<span class="fc" id="L423">                    DateFormatUtils.assertRemaining(pos, hi);</span>
<span class="fc" id="L424">                    minute = Numbers.parseInt(in, pos, ++pos);</span>
<span class="fc" id="L425">                    break;</span>

                case DateFormatCompiler.OP_MINUTE_TWO_DIGITS:
<span class="fc" id="L428">                    DateFormatUtils.assertRemaining(pos + 1, hi);</span>
<span class="fc" id="L429">                    minute = Numbers.parseInt(in, pos, pos += 2);</span>
<span class="fc" id="L430">                    break;</span>

                case DateFormatCompiler.OP_MINUTE_GREEDY:
<span class="fc" id="L433">                    l = Numbers.parseIntSafely(in, pos, hi);</span>
<span class="fc" id="L434">                    minute = Numbers.decodeLowInt(l);</span>
<span class="fc" id="L435">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L436">                    break;</span>

                // HOUR (0-11)
                case DateFormatCompiler.OP_HOUR_12_ONE_DIGIT:
<span class="fc" id="L440">                    DateFormatUtils.assertRemaining(pos, hi);</span>
<span class="fc" id="L441">                    hour = Numbers.parseInt(in, pos, ++pos);</span>
<span class="pc bpc" id="L442" title="1 of 2 branches missed.">                    if (hourType == DateFormatUtils.HOUR_24) {</span>
<span class="fc" id="L443">                        hourType = DateFormatUtils.HOUR_AM;</span>
                    }
                    break;

                case DateFormatCompiler.OP_HOUR_12_TWO_DIGITS:
<span class="fc" id="L448">                    DateFormatUtils.assertRemaining(pos + 1, hi);</span>
<span class="fc" id="L449">                    hour = Numbers.parseInt(in, pos, pos += 2);</span>
<span class="pc bpc" id="L450" title="1 of 2 branches missed.">                    if (hourType == DateFormatUtils.HOUR_24) {</span>
<span class="fc" id="L451">                        hourType = DateFormatUtils.HOUR_AM;</span>
                    }
                    break;

                case DateFormatCompiler.OP_HOUR_12_GREEDY:
<span class="fc" id="L456">                    l = Numbers.parseIntSafely(in, pos, hi);</span>
<span class="fc" id="L457">                    hour = Numbers.decodeLowInt(l);</span>
<span class="fc" id="L458">                    pos += Numbers.decodeHighInt(l);</span>
<span class="pc bpc" id="L459" title="1 of 2 branches missed.">                    if (hourType == DateFormatUtils.HOUR_24) {</span>
<span class="fc" id="L460">                        hourType = DateFormatUtils.HOUR_AM;</span>
                    }
                    break;

                // HOUR (1-12)
                case DateFormatCompiler.OP_HOUR_12_ONE_DIGIT_ONE_BASED:
<span class="fc" id="L466">                    DateFormatUtils.assertRemaining(pos, hi);</span>
<span class="fc" id="L467">                    hour = Numbers.parseInt(in, pos, ++pos) - 1;</span>
<span class="pc bpc" id="L468" title="1 of 2 branches missed.">                    if (hourType == DateFormatUtils.HOUR_24) {</span>
<span class="fc" id="L469">                        hourType = DateFormatUtils.HOUR_AM;</span>
                    }
                    break;

                case DateFormatCompiler.OP_HOUR_12_TWO_DIGITS_ONE_BASED:
<span class="fc" id="L474">                    DateFormatUtils.assertRemaining(pos + 1, hi);</span>
<span class="fc" id="L475">                    hour = Numbers.parseInt(in, pos, pos += 2) - 1;</span>
<span class="pc bpc" id="L476" title="1 of 2 branches missed.">                    if (hourType == DateFormatUtils.HOUR_24) {</span>
<span class="fc" id="L477">                        hourType = DateFormatUtils.HOUR_AM;</span>
                    }
                    break;

                case DateFormatCompiler.OP_HOUR_12_GREEDY_ONE_BASED:
<span class="fc" id="L482">                    l = Numbers.parseIntSafely(in, pos, hi);</span>
<span class="fc" id="L483">                    hour = Numbers.decodeLowInt(l) - 1;</span>
<span class="fc" id="L484">                    pos += Numbers.decodeHighInt(l);</span>
<span class="pc bpc" id="L485" title="1 of 2 branches missed.">                    if (hourType == DateFormatUtils.HOUR_24) {</span>
<span class="fc" id="L486">                        hourType = DateFormatUtils.HOUR_AM;</span>
                    }
                    break;

                // HOUR (0-23)
                case DateFormatCompiler.OP_HOUR_24_ONE_DIGIT:
<span class="fc" id="L492">                    DateFormatUtils.assertRemaining(pos, hi);</span>
<span class="fc" id="L493">                    hour = Numbers.parseInt(in, pos, ++pos);</span>
<span class="fc" id="L494">                    break;</span>

                case DateFormatCompiler.OP_HOUR_24_TWO_DIGITS:
<span class="fc" id="L497">                    DateFormatUtils.assertRemaining(pos + 1, hi);</span>
<span class="fc" id="L498">                    hour = Numbers.parseInt(in, pos, pos += 2);</span>
<span class="fc" id="L499">                    break;</span>

                case DateFormatCompiler.OP_HOUR_24_GREEDY:
<span class="fc" id="L502">                    l = Numbers.parseIntSafely(in, pos, hi);</span>
<span class="fc" id="L503">                    hour = Numbers.decodeLowInt(l);</span>
<span class="fc" id="L504">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L505">                    break;</span>

                // HOUR (1 - 24)
                case DateFormatCompiler.OP_HOUR_24_ONE_DIGIT_ONE_BASED:
<span class="fc" id="L509">                    DateFormatUtils.assertRemaining(pos, hi);</span>
<span class="fc" id="L510">                    hour = Numbers.parseInt(in, pos, ++pos) - 1;</span>
<span class="fc" id="L511">                    break;</span>

                case DateFormatCompiler.OP_HOUR_24_TWO_DIGITS_ONE_BASED:
<span class="fc" id="L514">                    DateFormatUtils.assertRemaining(pos + 1, hi);</span>
<span class="fc" id="L515">                    hour = Numbers.parseInt(in, pos, pos += 2) - 1;</span>
<span class="fc" id="L516">                    break;</span>

                case DateFormatCompiler.OP_HOUR_24_GREEDY_ONE_BASED:
<span class="fc" id="L519">                    l = Numbers.parseIntSafely(in, pos, hi);</span>
<span class="fc" id="L520">                    hour = Numbers.decodeLowInt(l) - 1;</span>
<span class="fc" id="L521">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L522">                    break;</span>

                // DAY
                case DateFormatCompiler.OP_DAY_ONE_DIGIT:
<span class="fc" id="L526">                    DateFormatUtils.assertRemaining(pos, hi);</span>
<span class="fc" id="L527">                    day = Numbers.parseInt(in, pos, ++pos);</span>
<span class="fc" id="L528">                    break;</span>
                case DateFormatCompiler.OP_DAY_TWO_DIGITS:
<span class="fc" id="L530">                    DateFormatUtils.assertRemaining(pos + 1, hi);</span>
<span class="fc" id="L531">                    day = Numbers.parseInt(in, pos, pos += 2);</span>
<span class="fc" id="L532">                    break;</span>
                case DateFormatCompiler.OP_DAY_GREEDY:
<span class="fc" id="L534">                    l = Numbers.parseIntSafely(in, pos, hi);</span>
<span class="fc" id="L535">                    day = Numbers.decodeLowInt(l);</span>
<span class="fc" id="L536">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L537">                    break;</span>

                case DateFormatCompiler.OP_DAY_NAME_LONG:
                case DateFormatCompiler.OP_DAY_NAME_SHORT:
<span class="fc" id="L541">                    l = locale.matchWeekday(in, pos, hi);</span>
                    // ignore weekday
<span class="fc" id="L543">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L544">                    break;</span>

                case DateFormatCompiler.OP_WEEK_OF_YEAR:
                case DateFormatCompiler.OP_DAY_OF_YEAR:
<span class="fc" id="L548">                    l = Numbers.parseIntSafely(in, pos, hi);</span>
<span class="fc" id="L549">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L550">                    break;</span>
                case DateFormatCompiler.OP_WEEK_OF_MONTH:
                case DateFormatCompiler.OP_DAY_OF_WEEK:
<span class="fc" id="L553">                    DateFormatUtils.assertRemaining(pos, hi);</span>
                    // ignore weekday and day of year
<span class="fc" id="L555">                    Numbers.parseInt(in, pos, ++pos);</span>
<span class="fc" id="L556">                    break;</span>

                // MONTH

                case DateFormatCompiler.OP_MONTH_ONE_DIGIT:
<span class="fc" id="L561">                    DateFormatUtils.assertRemaining(pos, hi);</span>
<span class="fc" id="L562">                    month = Numbers.parseInt(in, pos, ++pos);</span>
<span class="fc" id="L563">                    break;</span>
                case DateFormatCompiler.OP_MONTH_TWO_DIGITS:
<span class="fc" id="L565">                    DateFormatUtils.assertRemaining(pos + 1, hi);</span>
<span class="fc" id="L566">                    month = Numbers.parseInt(in, pos, pos += 2);</span>
<span class="fc" id="L567">                    break;</span>
                case DateFormatCompiler.OP_MONTH_GREEDY:
<span class="fc" id="L569">                    l = Numbers.parseIntSafely(in, pos, hi);</span>
<span class="fc" id="L570">                    month = Numbers.decodeLowInt(l);</span>
<span class="fc" id="L571">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L572">                    break;</span>

                case DateFormatCompiler.OP_MONTH_SHORT_NAME:
                case DateFormatCompiler.OP_MONTH_LONG_NAME:
<span class="fc" id="L576">                    l = locale.matchMonth(in, pos, hi);</span>
<span class="fc" id="L577">                    month = Numbers.decodeLowInt(l) + 1;</span>
<span class="fc" id="L578">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L579">                    break;</span>

                // YEAR

                case DateFormatCompiler.OP_YEAR_ONE_DIGIT:
<span class="fc" id="L584">                    DateFormatUtils.assertRemaining(pos, hi);</span>
<span class="fc" id="L585">                    year = Numbers.parseInt(in, pos, ++pos);</span>
<span class="fc" id="L586">                    break;</span>
                case DateFormatCompiler.OP_YEAR_TWO_DIGITS:
<span class="fc" id="L588">                    DateFormatUtils.assertRemaining(pos + 1, hi);</span>
<span class="fc" id="L589">                    year = DateFormatUtils.adjustYear(Numbers.parseInt(in, pos, pos += 2));</span>
<span class="fc" id="L590">                    break;</span>
                case DateFormatCompiler.OP_YEAR_THREE_DIGITS:
<span class="fc" id="L592">                    DateFormatUtils.assertRemaining(pos + 2, hi);</span>
<span class="fc" id="L593">                    year = DateFormatUtils.adjustYearMillenium(Numbers.parseInt(in, pos, pos += 3));</span>
<span class="fc" id="L594">                    break;</span>
                case DateFormatCompiler.OP_YEAR_FOUR_DIGITS:
<span class="pc bpc" id="L596" title="1 of 4 branches missed.">                    if (pos &lt; hi &amp;&amp; in.charAt(pos) == '-') {</span>
<span class="fc" id="L597">                        DateFormatUtils.assertRemaining(pos + 4, hi);</span>
<span class="fc" id="L598">                        year = -Numbers.parseInt(in, pos + 1, pos += 5);</span>
                    } else {
<span class="fc" id="L600">                        DateFormatUtils.assertRemaining(pos + 3, hi);</span>
<span class="fc" id="L601">                        year = Numbers.parseInt(in, pos, pos += 4);</span>
                    }
<span class="fc" id="L603">                    break;</span>
                case DateFormatCompiler.OP_YEAR_GREEDY:
<span class="fc" id="L605">                    l = DateFormatUtils.parseYearGreedy(in, pos, hi);</span>
<span class="fc" id="L606">                    year = Numbers.decodeLowInt(l);</span>
<span class="fc" id="L607">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L608">                    break;</span>

                // ERA
                case DateFormatCompiler.OP_ERA:
<span class="fc" id="L612">                    l = locale.matchEra(in, pos, hi);</span>
<span class="fc" id="L613">                    era = Numbers.decodeLowInt(l);</span>
<span class="fc" id="L614">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L615">                    break;</span>

                // TIMEZONE
                case DateFormatCompiler.OP_TIME_ZONE_SHORT:
                case DateFormatCompiler.OP_TIME_ZONE_GMT_BASED:
                case DateFormatCompiler.OP_TIME_ZONE_ISO_8601_1:
                case DateFormatCompiler.OP_TIME_ZONE_ISO_8601_2:
                case DateFormatCompiler.OP_TIME_ZONE_ISO_8601_3:
                case DateFormatCompiler.OP_TIME_ZONE_LONG:
                case DateFormatCompiler.OP_TIME_ZONE_RFC_822:

<span class="fc" id="L626">                    l = Dates.parseOffset(in, pos, hi);</span>
<span class="fc bfc" id="L627" title="All 2 branches covered.">                    if (l == Long.MIN_VALUE) {</span>
<span class="fc" id="L628">                        l = locale.matchZone(in, pos, hi);</span>
<span class="fc" id="L629">                        timezone = Numbers.decodeLowInt(l);</span>
                    } else {
<span class="fc" id="L631">                        offset = Numbers.decodeLowInt(l) * Dates.MINUTE_MILLIS;</span>
                    }
<span class="fc" id="L633">                    pos += Numbers.decodeHighInt(l);</span>
<span class="fc" id="L634">                    break;</span>

                // SEPARATORS
                default:
<span class="fc" id="L638">                    String delimiter = delimiters.getQuick(-op - 1);</span>
<span class="fc" id="L639">                    len = delimiter.length();</span>
<span class="fc bfc" id="L640" title="All 2 branches covered.">                    if (len == 1) {</span>
<span class="fc" id="L641">                        DateFormatUtils.assertChar(delimiter.charAt(0), in, pos++, hi);</span>
                    } else {
<span class="fc" id="L643">                        pos = DateFormatUtils.assertString(delimiter, len, in, pos, hi);</span>
                    }
                    break;
            }
        }

<span class="fc" id="L649">        DateFormatUtils.assertNoTail(pos, hi);</span>

<span class="fc" id="L651">        return DateFormatUtils.compute(locale, era, year, month, day, hour, minute, second, millis, timezone, offset, hourType);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>