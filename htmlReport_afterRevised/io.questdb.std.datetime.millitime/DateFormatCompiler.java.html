<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DateFormatCompiler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">All in questdb Coverage Results</a> &gt; <a href="index.source.html" class="el_package">io.questdb.std.datetime.millitime</a> &gt; <span class="el_source">DateFormatCompiler.java</span></div><h1>DateFormatCompiler.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 *     ___                  _   ____  ____
 *    / _ \ _   _  ___  ___| |_|  _ \| __ )
 *   | | | | | | |/ _ \/ __| __| | | |  _ \
 *   | |_| | |_| |  __/\__ \ |_| |_| | |_) |
 *    \__\_\\__,_|\___||___/\__|____/|____/
 *
 *  Copyright (c) 2014-2019 Appsicle
 *  Copyright (c) 2019-2022 QuestDB
 *
 *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 ******************************************************************************/

package io.questdb.std.datetime.millitime;


import io.questdb.std.*;
import io.questdb.std.datetime.AbstractDateFormat;
import io.questdb.std.datetime.DateFormat;
import io.questdb.std.datetime.DateLocale;
import io.questdb.std.datetime.microtime.TimestampFormatUtils;
import io.questdb.std.str.CharSink;

public class DateFormatCompiler {
    static final int OP_AM_PM = 14;
    static final int OP_DAY_GREEDY = 139;
    static final int OP_DAY_NAME_LONG = 12;
    static final int OP_DAY_NAME_SHORT = 11;
    static final int OP_DAY_OF_WEEK = 13;
    static final int OP_DAY_OF_YEAR = 36;
    static final int OP_DAY_ONE_DIGIT = 9;
    static final int OP_DAY_TWO_DIGITS = 10;
    static final int OP_ERA = 1;
    static final int OP_HOUR_12_GREEDY = 142;
    static final int OP_HOUR_12_GREEDY_ONE_BASED = 143;
    static final int OP_HOUR_12_ONE_DIGIT = 17;
    static final int OP_HOUR_12_ONE_DIGIT_ONE_BASED = 18;
    static final int OP_HOUR_12_TWO_DIGITS = 34;
    static final int OP_HOUR_12_TWO_DIGITS_ONE_BASED = 35;
    static final int OP_HOUR_24_GREEDY = 140;
    static final int OP_HOUR_24_GREEDY_ONE_BASED = 141;
    static final int OP_HOUR_24_ONE_DIGIT = 15;
    static final int OP_HOUR_24_ONE_DIGIT_ONE_BASED = 16;
    static final int OP_HOUR_24_TWO_DIGITS = 32;
    static final int OP_HOUR_24_TWO_DIGITS_ONE_BASED = 33;
    static final int OP_MILLIS_GREEDY = 146;
    static final int OP_MILLIS_ONE_DIGIT = 21;
    static final int OP_MILLIS_THREE_DIGITS = 31;
    static final int OP_MINUTE_GREEDY = 144;
    static final int OP_MINUTE_ONE_DIGIT = 19;
    static final int OP_MINUTE_TWO_DIGITS = 29;
    static final int OP_MONTH_GREEDY = 135;
    static final int OP_MONTH_LONG_NAME = 8;
    static final int OP_MONTH_ONE_DIGIT = 5;
    static final int OP_MONTH_SHORT_NAME = 7;
    static final int OP_MONTH_TWO_DIGITS = 6;
    static final int OP_SECOND_GREEDY = 145;
    static final int OP_SECOND_ONE_DIGIT = 20;
    static final int OP_SECOND_TWO_DIGITS = 30;
    static final int OP_TIME_ZONE_GMT_BASED = 22;
    static final int OP_TIME_ZONE_ISO_8601_1 = 26;
    static final int OP_TIME_ZONE_ISO_8601_2 = 27;
    static final int OP_TIME_ZONE_ISO_8601_3 = 28;
    static final int OP_TIME_ZONE_LONG = 24;
    static final int OP_TIME_ZONE_RFC_822 = 25;
    static final int OP_TIME_ZONE_SHORT = 23;
    static final int OP_WEEK_OF_MONTH = 38;
    static final int OP_WEEK_OF_YEAR = 37;
    static final int OP_YEAR_FOUR_DIGITS = 4;
    static final int OP_YEAR_GREEDY = 132;
    static final int OP_YEAR_ONE_DIGIT = 2;
    static final int OP_YEAR_THREE_DIGITS = 39;
    static final int OP_YEAR_TWO_DIGITS = 3;
    static final ObjList&lt;String&gt; opList;
    static final CharSequenceIntHashMap opMap;
    private static final int FA_DAY = 5;
    private static final int FA_DAY_OF_WEEK = 10;
    private static final int FA_DAY_OF_YEAR = 11;
    private static final int FA_HOUR = 4;
    private static final int FA_LEAP = 8;
    private static final int FA_LOCAL_DATETIME = 1;
    private static final int FA_LOCAL_LOCALE = 3;
    private static final int FA_LOCAL_SINK = 5;
    private static final int FA_LOCAL_TIMEZONE = 4;
    private static final int FA_MINUTE = 3;
    private static final int FA_MONTH = 6;
    private static final int FA_SECOND = 2;
    private static final int FA_SECOND_MILLIS = 1;
    private static final int FA_WEEK_OF_MONTH = 13;
    private static final int FA_WEEK_OF_YEAR = 12;
    private static final int FA_YEAR = 7;
    private static final int FORMAT_METHOD_STACK_START = 6;
    private static final int LOCAL_DAY = 5;
    private static final int LOCAL_ERA = 19;
    private static final int LOCAL_HOUR = 8;
    private static final int LOCAL_HOUR_TYPE = 18;
    private static final int LOCAL_MILLIS = 11;
    private static final int LOCAL_MINUTE = 9;
    private static final int LOCAL_MONTH = 6;
    private static final int LOCAL_OFFSET = 16;
    private static final int LOCAL_POS = 12;
    private static final int LOCAL_SECOND = 10;
    private static final int LOCAL_TEMP_LONG = 13;
    private static final int LOCAL_TIMEZONE = 15;
    private static final int LOCAL_YEAR = 7;
    private static final int P_HI = 3;
    private static final int P_INPUT_STR = 1;
    private static final int P_LO = 2;
    private static final int P_LOCALE = 4;
<span class="fc" id="L121">    private final BytecodeAssembler asm = new BytecodeAssembler();</span>
<span class="fc" id="L122">    private final IntList delimiterIndexes = new IntList();</span>
<span class="fc" id="L123">    private final ObjList&lt;String&gt; delimiters = new ObjList&lt;&gt;();</span>
<span class="fc" id="L124">    private final int[] fmtAttributeIndex = new int[32];</span>
<span class="fc" id="L125">    private final LongList frameOffsets = new LongList();</span>
<span class="fc" id="L126">    private final GenericLexer lexer = new GenericLexer(2048);</span>
<span class="fc" id="L127">    private final IntList ops = new IntList();</span>

<span class="fc" id="L129">    public DateFormatCompiler() {</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">        for (int i = 0, n = opList.size(); i &lt; n; i++) {</span>
<span class="fc" id="L131">            lexer.defineSymbol(opList.getQuick(i));</span>
        }
<span class="fc" id="L133">    }</span>

    public DateFormat compile(CharSequence pattern) {
<span class="fc" id="L136">        return compile(pattern, false);</span>
    }

    public DateFormat compile(CharSequence pattern, boolean generic) {
<span class="fc" id="L140">        return compile(pattern, 0, pattern.length(), generic);</span>
    }

    public DateFormat compile(CharSequence pattern, int lo, int hi, boolean generic) {
<span class="fc" id="L144">        this.lexer.of(pattern, lo, hi);</span>

        IntList ops;
        ObjList&lt;String&gt; delimiters;

<span class="fc bfc" id="L149" title="All 2 branches covered.">        if (generic) {</span>
<span class="fc" id="L150">            ops = new IntList();</span>
<span class="fc" id="L151">            delimiters = new ObjList&lt;&gt;();</span>
        } else {
<span class="fc" id="L153">            ops = this.ops;</span>
<span class="fc" id="L154">            delimiters = this.delimiters;</span>
<span class="fc" id="L155">            ops.clear();</span>
<span class="fc" id="L156">            delimiters.clear();</span>
        }

<span class="fc bfc" id="L159" title="All 2 branches covered.">        while (this.lexer.hasNext()) {</span>
<span class="fc" id="L160">            final CharSequence cs = lexer.next();</span>
<span class="fc" id="L161">            final int op = opMap.get(cs);</span>
<span class="fc bfc" id="L162" title="All 3 branches covered.">            switch (op) {</span>
                case -1:
<span class="fc" id="L164">                    makeLastOpGreedy(ops);</span>
<span class="fc" id="L165">                    delimiters.add(Chars.toString(cs));</span>
<span class="fc" id="L166">                    ops.add(-(delimiters.size()));</span>
<span class="fc" id="L167">                    break;</span>
                case OP_AM_PM:
                case OP_TIME_ZONE_SHORT:
<span class="fc" id="L170">                    makeLastOpGreedy(ops);</span>
                    // fall thru
                default:
<span class="fc" id="L173">                    ops.add(op);</span>
                    break;

            }
<span class="fc" id="L177">        }</span>

        // make last operation &quot;greedy&quot;
<span class="fc" id="L180">        makeLastOpGreedy(ops);</span>
<span class="fc bfc" id="L181" title="All 2 branches covered.">        return generic ? new GenericDateFormat(ops, delimiters) : compile(ops, delimiters);</span>
    }

    private static void addOp(String op, int opDayTwoDigits) {
<span class="fc" id="L185">        opMap.put(op, opDayTwoDigits);</span>
<span class="fc" id="L186">        opList.add(op);</span>
<span class="fc" id="L187">    }</span>

    private void addTempToPos(int decodeLenIndex) {
<span class="fc" id="L190">        asm.iload(LOCAL_POS);</span>
<span class="fc" id="L191">        decodeInt(decodeLenIndex);</span>
<span class="fc" id="L192">        asm.iadd();</span>
<span class="fc" id="L193">        asm.istore(LOCAL_POS);</span>
<span class="fc" id="L194">    }</span>

    private void assembleFormatMethod(
            IntList ops,
            ObjList&lt;String&gt; delimiters,
            int getWeekdayIndex,
            int getShortWeekdayIndex,
            int getMonthIndex,
            int getShortMonthIndex,
            int appendEraIndex,
            int appendAmPmIndex,
            int appendHour12Index,
            int appendHour12PaddedIndex,
            int appendHour121Index,
            int appendHour121PaddedIndex,
            int getYearIndex,
            int isLeapYearIndex,
            int getMonthOfYearIndex,
            int getDayOfMonthIndex,
            int getHourOfDayIndex,
            int getMinuteOfHourIndex,
            int getSecondOfMinuteIndex,
            int getMillisOfSecondIndex,
            int getDayOfWeekIndex,
            int getDayOfYearIndex,
            int getWeekOfYearIndex,
            int getWeekOfMonthIndex,
            int appendYear000Index,
            int append00Index,
            int append0Index,
            int sinkPutIntIndex,
            int sinkPutStrIndex,
            int sinkPutChrIndex,
            int formatNameIndex,
            int formatSigIndex
    ) {
<span class="fc" id="L230">        int formatAttributes = computeFormatAttributes(ops);</span>
<span class="fc" id="L231">        asm.startMethod(</span>
                formatNameIndex,
                formatSigIndex,
                6,
<span class="fc" id="L235">                FORMAT_METHOD_STACK_START + Integer.bitCount(formatAttributes)</span>
        );

<span class="fc" id="L238">        assembleFormatMethodStack(</span>
                formatAttributes,
                getYearIndex,
                isLeapYearIndex,
                getMonthOfYearIndex,
                getDayOfMonthIndex,
                getHourOfDayIndex,
                getMinuteOfHourIndex,
                getSecondOfMinuteIndex,
                getMillisOfSecondIndex,
                getDayOfWeekIndex,
                getDayOfYearIndex,
                getWeekOfYearIndex,
                getWeekOfMonthIndex
        );

<span class="fc bfc" id="L254" title="All 2 branches covered.">        for (int i = 0, n = ops.size(); i &lt; n; i++) {</span>
<span class="fc" id="L255">            int op = ops.getQuick(i);</span>
<span class="fc bfc" id="L256" title="All 34 branches covered.">            switch (op) {</span>
                // AM/PM
                case DateFormatCompiler.OP_AM_PM:
<span class="fc" id="L259">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L260">                    asm.iload(fmtAttributeIndex[FA_HOUR]);</span>
<span class="fc" id="L261">                    asm.aload(FA_LOCAL_LOCALE);</span>
<span class="fc" id="L262">                    asm.invokeStatic(appendAmPmIndex);</span>
<span class="fc" id="L263">                    break;</span>
                // MILLIS
                case DateFormatCompiler.OP_MILLIS_ONE_DIGIT:
                case DateFormatCompiler.OP_MILLIS_GREEDY:
<span class="fc" id="L267">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L268">                    asm.iload(fmtAttributeIndex[FA_SECOND_MILLIS]);</span>
<span class="fc" id="L269">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L270">                    asm.pop();</span>
<span class="fc" id="L271">                    break;</span>
                case DateFormatCompiler.OP_MILLIS_THREE_DIGITS:
<span class="fc" id="L273">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L274">                    asm.iload(fmtAttributeIndex[FA_SECOND_MILLIS]);</span>
<span class="fc" id="L275">                    asm.invokeStatic(append00Index);</span>
<span class="fc" id="L276">                    break;</span>
                // SECOND
                case DateFormatCompiler.OP_SECOND_ONE_DIGIT:
                case DateFormatCompiler.OP_SECOND_GREEDY:
<span class="fc" id="L280">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L281">                    asm.iload(fmtAttributeIndex[FA_SECOND]);</span>
<span class="fc" id="L282">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L283">                    asm.pop();</span>
<span class="fc" id="L284">                    break;</span>
                case DateFormatCompiler.OP_SECOND_TWO_DIGITS:
<span class="fc" id="L286">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L287">                    asm.iload(fmtAttributeIndex[FA_SECOND]);</span>
<span class="fc" id="L288">                    asm.invokeStatic(append0Index);</span>
<span class="fc" id="L289">                    break;</span>
                // MINUTE
                case DateFormatCompiler.OP_MINUTE_ONE_DIGIT:
                case DateFormatCompiler.OP_MINUTE_GREEDY:
<span class="fc" id="L293">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L294">                    asm.iload(fmtAttributeIndex[FA_MINUTE]);</span>
<span class="fc" id="L295">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L296">                    asm.pop();</span>
<span class="fc" id="L297">                    break;</span>
                case DateFormatCompiler.OP_MINUTE_TWO_DIGITS:
<span class="fc" id="L299">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L300">                    asm.iload(fmtAttributeIndex[FA_MINUTE]);</span>
<span class="fc" id="L301">                    asm.invokeStatic(append0Index);</span>
<span class="fc" id="L302">                    break;</span>
                // HOUR (0-11)
                case DateFormatCompiler.OP_HOUR_12_ONE_DIGIT:
                case DateFormatCompiler.OP_HOUR_12_GREEDY:
<span class="fc" id="L306">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L307">                    asm.iload(fmtAttributeIndex[FA_HOUR]);</span>
<span class="fc" id="L308">                    asm.invokeStatic(appendHour12Index);</span>
<span class="fc" id="L309">                    break;</span>

                case DateFormatCompiler.OP_HOUR_12_TWO_DIGITS:
<span class="fc" id="L312">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L313">                    asm.iload(fmtAttributeIndex[FA_HOUR]);</span>
<span class="fc" id="L314">                    asm.invokeStatic(appendHour12PaddedIndex);</span>
<span class="fc" id="L315">                    break;</span>

                // HOUR (1-12)
                case DateFormatCompiler.OP_HOUR_12_ONE_DIGIT_ONE_BASED:
                case DateFormatCompiler.OP_HOUR_12_GREEDY_ONE_BASED:
<span class="fc" id="L320">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L321">                    asm.iload(fmtAttributeIndex[FA_HOUR]);</span>
<span class="fc" id="L322">                    asm.invokeStatic(appendHour121Index);</span>
<span class="fc" id="L323">                    break;</span>

                case DateFormatCompiler.OP_HOUR_12_TWO_DIGITS_ONE_BASED:
<span class="fc" id="L326">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L327">                    asm.iload(fmtAttributeIndex[FA_HOUR]);</span>
<span class="fc" id="L328">                    asm.invokeStatic(appendHour121PaddedIndex);</span>
<span class="fc" id="L329">                    break;</span>
                // HOUR (0-23)
                case DateFormatCompiler.OP_HOUR_24_ONE_DIGIT:
                case DateFormatCompiler.OP_HOUR_24_GREEDY:
<span class="fc" id="L333">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L334">                    asm.iload(fmtAttributeIndex[FA_HOUR]);</span>
<span class="fc" id="L335">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L336">                    asm.pop();</span>
<span class="fc" id="L337">                    break;</span>
                case DateFormatCompiler.OP_HOUR_24_TWO_DIGITS:
<span class="fc" id="L339">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L340">                    asm.iload(fmtAttributeIndex[FA_HOUR]);</span>
<span class="fc" id="L341">                    asm.invokeStatic(append0Index);</span>
<span class="fc" id="L342">                    break;</span>

                // HOUR (1 - 24)
                case DateFormatCompiler.OP_HOUR_24_ONE_DIGIT_ONE_BASED:
                case DateFormatCompiler.OP_HOUR_24_GREEDY_ONE_BASED:
<span class="fc" id="L347">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L348">                    asm.iload(fmtAttributeIndex[FA_HOUR]);</span>
<span class="fc" id="L349">                    asm.iconst(1);</span>
<span class="fc" id="L350">                    asm.iadd();</span>
<span class="fc" id="L351">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L352">                    asm.pop();</span>
<span class="fc" id="L353">                    break;</span>

                case DateFormatCompiler.OP_HOUR_24_TWO_DIGITS_ONE_BASED:
<span class="fc" id="L356">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L357">                    asm.iload(fmtAttributeIndex[FA_HOUR]);</span>
<span class="fc" id="L358">                    asm.iconst(1);</span>
<span class="fc" id="L359">                    asm.iadd();</span>
<span class="fc" id="L360">                    asm.invokeStatic(append0Index);</span>
<span class="fc" id="L361">                    break;</span>
                // DAY
                case DateFormatCompiler.OP_DAY_ONE_DIGIT:
                case DateFormatCompiler.OP_DAY_GREEDY:
<span class="fc" id="L365">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L366">                    asm.iload(fmtAttributeIndex[FA_DAY]);</span>
<span class="fc" id="L367">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L368">                    asm.pop();</span>
<span class="fc" id="L369">                    break;</span>
                case DateFormatCompiler.OP_DAY_TWO_DIGITS:
<span class="fc" id="L371">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L372">                    asm.iload(fmtAttributeIndex[FA_DAY]);</span>
<span class="fc" id="L373">                    asm.invokeStatic(append0Index);</span>
<span class="fc" id="L374">                    break;</span>
                case DateFormatCompiler.OP_DAY_NAME_LONG:
<span class="fc" id="L376">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L377">                    asm.aload(FA_LOCAL_LOCALE);</span>
<span class="fc" id="L378">                    asm.iload(fmtAttributeIndex[FA_DAY_OF_WEEK]);</span>
<span class="fc" id="L379">                    asm.invokeVirtual(getWeekdayIndex);</span>
<span class="fc" id="L380">                    asm.invokeInterface(sinkPutStrIndex, 1);</span>
<span class="fc" id="L381">                    asm.pop();</span>
<span class="fc" id="L382">                    break;</span>
                case DateFormatCompiler.OP_DAY_NAME_SHORT:
<span class="fc" id="L384">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L385">                    asm.aload(FA_LOCAL_LOCALE);</span>
<span class="fc" id="L386">                    asm.iload(fmtAttributeIndex[FA_DAY_OF_WEEK]);</span>
<span class="fc" id="L387">                    asm.invokeVirtual(getShortWeekdayIndex);</span>
<span class="fc" id="L388">                    asm.invokeInterface(sinkPutStrIndex, 1);</span>
<span class="fc" id="L389">                    asm.pop();</span>
<span class="fc" id="L390">                    break;</span>
                case DateFormatCompiler.OP_DAY_OF_WEEK:
<span class="fc" id="L392">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L393">                    asm.iload(fmtAttributeIndex[FA_DAY_OF_WEEK]);</span>
<span class="fc" id="L394">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L395">                    asm.pop();</span>
<span class="fc" id="L396">                    break;</span>
                case DateFormatCompiler.OP_DAY_OF_YEAR:
<span class="fc" id="L398">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L399">                    asm.iload(fmtAttributeIndex[FA_DAY_OF_YEAR]);</span>
<span class="fc" id="L400">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L401">                    asm.pop();</span>
<span class="fc" id="L402">                    break;</span>
                case DateFormatCompiler.OP_WEEK_OF_YEAR:
<span class="fc" id="L404">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L405">                    asm.iload(fmtAttributeIndex[FA_WEEK_OF_YEAR]);</span>
<span class="fc" id="L406">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L407">                    asm.pop();</span>
<span class="fc" id="L408">                    break;</span>
                case DateFormatCompiler.OP_WEEK_OF_MONTH:
<span class="fc" id="L410">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L411">                    asm.iload(fmtAttributeIndex[FA_WEEK_OF_MONTH]);</span>
<span class="fc" id="L412">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L413">                    asm.pop();</span>
<span class="fc" id="L414">                    break;</span>
                // MONTH
                case DateFormatCompiler.OP_MONTH_ONE_DIGIT:
                case DateFormatCompiler.OP_MONTH_GREEDY:
<span class="fc" id="L418">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L419">                    asm.iload(fmtAttributeIndex[FA_MONTH]);</span>
<span class="fc" id="L420">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L421">                    asm.pop();</span>
<span class="fc" id="L422">                    break;</span>
                case DateFormatCompiler.OP_MONTH_TWO_DIGITS:
<span class="fc" id="L424">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L425">                    asm.iload(fmtAttributeIndex[FA_MONTH]);</span>
<span class="fc" id="L426">                    asm.invokeStatic(append0Index);</span>
<span class="fc" id="L427">                    break;</span>
                case DateFormatCompiler.OP_MONTH_SHORT_NAME:
<span class="fc" id="L429">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L430">                    asm.aload(FA_LOCAL_LOCALE);</span>
<span class="fc" id="L431">                    asm.iload(fmtAttributeIndex[FA_MONTH]);</span>
<span class="fc" id="L432">                    asm.iconst(1);</span>
<span class="fc" id="L433">                    asm.isub();</span>
<span class="fc" id="L434">                    asm.invokeVirtual(getShortMonthIndex);</span>
<span class="fc" id="L435">                    asm.invokeInterface(sinkPutStrIndex, 1);</span>
<span class="fc" id="L436">                    asm.pop();</span>
<span class="fc" id="L437">                    break;</span>
                case DateFormatCompiler.OP_MONTH_LONG_NAME:
<span class="fc" id="L439">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L440">                    asm.aload(FA_LOCAL_LOCALE);</span>
<span class="fc" id="L441">                    asm.iload(fmtAttributeIndex[FA_MONTH]);</span>
<span class="fc" id="L442">                    asm.iconst(1);</span>
<span class="fc" id="L443">                    asm.isub();</span>
<span class="fc" id="L444">                    asm.invokeVirtual(getMonthIndex);</span>
<span class="fc" id="L445">                    asm.invokeInterface(sinkPutStrIndex, 1);</span>
<span class="fc" id="L446">                    asm.pop();</span>
<span class="fc" id="L447">                    break;</span>
                // YEAR
                case DateFormatCompiler.OP_YEAR_ONE_DIGIT:
                case DateFormatCompiler.OP_YEAR_GREEDY:
<span class="fc" id="L451">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L452">                    asm.iload(fmtAttributeIndex[FA_YEAR]);</span>
<span class="fc" id="L453">                    asm.invokeInterface(sinkPutIntIndex, 1);</span>
<span class="fc" id="L454">                    asm.pop();</span>
<span class="fc" id="L455">                    break;</span>
                case DateFormatCompiler.OP_YEAR_TWO_DIGITS:
<span class="fc" id="L457">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L458">                    asm.iload(fmtAttributeIndex[FA_YEAR]);</span>
<span class="fc" id="L459">                    asm.iconst(100);</span>
<span class="fc" id="L460">                    asm.irem();</span>
<span class="fc" id="L461">                    asm.invokeStatic(append0Index);</span>
<span class="fc" id="L462">                    break;</span>
                case DateFormatCompiler.OP_YEAR_THREE_DIGITS:
<span class="fc" id="L464">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L465">                    asm.iload(fmtAttributeIndex[FA_YEAR]);</span>
<span class="fc" id="L466">                    asm.iconst(1000);</span>
<span class="fc" id="L467">                    asm.irem();</span>
<span class="fc" id="L468">                    asm.invokeStatic(append00Index);</span>
<span class="fc" id="L469">                    break;</span>
                case DateFormatCompiler.OP_YEAR_FOUR_DIGITS:
<span class="fc" id="L471">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L472">                    asm.iload(fmtAttributeIndex[FA_YEAR]);</span>
<span class="fc" id="L473">                    asm.invokeStatic(appendYear000Index);</span>
<span class="fc" id="L474">                    break;</span>
                // ERA
                case DateFormatCompiler.OP_ERA:
<span class="fc" id="L477">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L478">                    asm.iload(fmtAttributeIndex[FA_YEAR]);</span>
<span class="fc" id="L479">                    asm.aload(FA_LOCAL_LOCALE);</span>
<span class="fc" id="L480">                    asm.invokeStatic(appendEraIndex);</span>
<span class="fc" id="L481">                    break;</span>

                // TIMEZONE
                case DateFormatCompiler.OP_TIME_ZONE_SHORT:
                case DateFormatCompiler.OP_TIME_ZONE_GMT_BASED:
                case DateFormatCompiler.OP_TIME_ZONE_ISO_8601_1:
                case DateFormatCompiler.OP_TIME_ZONE_ISO_8601_2:
                case DateFormatCompiler.OP_TIME_ZONE_ISO_8601_3:
                case DateFormatCompiler.OP_TIME_ZONE_LONG:
                case DateFormatCompiler.OP_TIME_ZONE_RFC_822:
<span class="fc" id="L491">                    asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L492">                    asm.aload(FA_LOCAL_TIMEZONE);</span>
<span class="fc" id="L493">                    asm.invokeInterface(sinkPutStrIndex, 1);</span>
<span class="fc" id="L494">                    break;</span>
                // SEPARATORS
                default:
<span class="pc bpc" id="L497" title="1 of 2 branches missed.">                    if (op &lt; 0) {</span>
<span class="fc" id="L498">                        String delimiter = delimiters.getQuick(-op - 1);</span>
<span class="fc bfc" id="L499" title="All 2 branches covered.">                        if (delimiter.length() &gt; 1) {</span>
<span class="fc" id="L500">                            asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L501">                            asm.ldc(delimiterIndexes.getQuick(-op - 1));</span>
<span class="fc" id="L502">                            asm.invokeInterface(sinkPutStrIndex, 1);</span>
                        } else {
<span class="fc" id="L504">                            asm.aload(FA_LOCAL_SINK);</span>
<span class="fc" id="L505">                            asm.iconst(delimiter.charAt(0));</span>
<span class="fc" id="L506">                            asm.invokeInterface(sinkPutChrIndex, 1);</span>
                        }
<span class="fc" id="L508">                        asm.pop();</span>
                    }
                    break;
            }
        }

<span class="fc" id="L514">        asm.return_();</span>
<span class="fc" id="L515">        asm.endMethodCode();</span>
<span class="fc" id="L516">        asm.putShort(0);</span>
<span class="fc" id="L517">        asm.putShort(0);</span>
<span class="fc" id="L518">        asm.endMethod();</span>
<span class="fc" id="L519">    }</span>

    private void assembleFormatMethodStack(
            int formatAttributes,
            int getYearIndex,
            int isLeapYearIndex,
            int getMonthOfYearIndex,
            int getDayOfMonthIndex,
            int getHourOfDayIndex,
            int getMinuteOfHourIndex,
            int getSecondOfMinuteIndex,
            int getMillisOfSecondIndex,
            int getDayOfWeekIndex,
            int getDayOfYearIndex,
            int getWeekOfYearIndex,
            int getWeekOfMonthIndex
    ) {
<span class="fc" id="L536">        int index = FORMAT_METHOD_STACK_START;</span>
<span class="fc bfc" id="L537" title="All 2 branches covered.">        if (invokeConvertMillis(formatAttributes, FA_YEAR, getYearIndex, index)) {</span>
<span class="fc" id="L538">            fmtAttributeIndex[FA_YEAR] = index++;</span>
        }

<span class="fc bfc" id="L541" title="All 2 branches covered.">        if ((formatAttributes &amp; (1 &lt;&lt; FA_LEAP)) != 0) {</span>
<span class="fc" id="L542">            asm.iload(fmtAttributeIndex[FA_YEAR]);</span>
<span class="fc" id="L543">            asm.invokeStatic(isLeapYearIndex);</span>
<span class="fc" id="L544">            asm.istore(index);</span>
<span class="fc" id="L545">            fmtAttributeIndex[FA_LEAP] = index++;</span>
        }

<span class="fc bfc" id="L548" title="All 2 branches covered.">        if ((formatAttributes &amp; (1 &lt;&lt; FA_MONTH)) != 0) {</span>
<span class="fc" id="L549">            asm.lload(FA_LOCAL_DATETIME);</span>
<span class="fc" id="L550">            asm.iload(fmtAttributeIndex[FA_YEAR]);</span>
<span class="fc" id="L551">            asm.iload(fmtAttributeIndex[FA_LEAP]);</span>
<span class="fc" id="L552">            asm.invokeStatic(getMonthOfYearIndex);</span>
<span class="fc" id="L553">            asm.istore(index);</span>
<span class="fc" id="L554">            fmtAttributeIndex[FA_MONTH] = index++;</span>
        }

<span class="fc bfc" id="L557" title="All 2 branches covered.">        if ((formatAttributes &amp; (1 &lt;&lt; FA_DAY)) != 0) {</span>
<span class="fc" id="L558">            asm.lload(FA_LOCAL_DATETIME);</span>
<span class="fc" id="L559">            asm.iload(fmtAttributeIndex[FA_YEAR]);</span>
<span class="fc" id="L560">            asm.iload(fmtAttributeIndex[FA_MONTH]);</span>
<span class="fc" id="L561">            asm.iload(fmtAttributeIndex[FA_LEAP]);</span>
<span class="fc" id="L562">            asm.invokeStatic(getDayOfMonthIndex);</span>
<span class="fc" id="L563">            asm.istore(index);</span>
<span class="fc" id="L564">            fmtAttributeIndex[FA_DAY] = index++;</span>
        }

<span class="fc bfc" id="L567" title="All 2 branches covered.">        if (invokeConvertMillis(formatAttributes, FA_HOUR, getHourOfDayIndex, index)) {</span>
<span class="fc" id="L568">            fmtAttributeIndex[FA_HOUR] = index++;</span>
        }

<span class="fc bfc" id="L571" title="All 2 branches covered.">        if (invokeConvertMillis(formatAttributes, FA_MINUTE, getMinuteOfHourIndex, index)) {</span>
<span class="fc" id="L572">            fmtAttributeIndex[FA_MINUTE] = index++;</span>
        }

<span class="fc bfc" id="L575" title="All 2 branches covered.">        if (invokeConvertMillis(formatAttributes, FA_SECOND, getSecondOfMinuteIndex, index)) {</span>
<span class="fc" id="L576">            fmtAttributeIndex[FA_SECOND] = index++;</span>
        }

<span class="fc bfc" id="L579" title="All 2 branches covered.">        if (invokeConvertMillis(formatAttributes, FA_SECOND_MILLIS, getMillisOfSecondIndex, index)) {</span>
<span class="fc" id="L580">            fmtAttributeIndex[FA_SECOND_MILLIS] = index++;</span>
        }

<span class="fc bfc" id="L583" title="All 2 branches covered.">        if (invokeConvertMillis(formatAttributes, FA_DAY_OF_WEEK, getDayOfWeekIndex, index)) {</span>
<span class="fc" id="L584">            fmtAttributeIndex[FA_DAY_OF_WEEK] = index;</span>
        }

<span class="fc bfc" id="L587" title="All 2 branches covered.">        if (invokeConvertMillis(formatAttributes, FA_DAY_OF_YEAR, getDayOfYearIndex, index)) {</span>
<span class="fc" id="L588">            fmtAttributeIndex[FA_DAY_OF_YEAR] = index;</span>
        }
<span class="fc bfc" id="L590" title="All 2 branches covered.">        if (invokeConvertMillis(formatAttributes, FA_WEEK_OF_MONTH, getWeekOfMonthIndex, index)) {</span>
<span class="fc" id="L591">            fmtAttributeIndex[FA_WEEK_OF_MONTH] = index;</span>
        }
<span class="fc bfc" id="L593" title="All 2 branches covered.">        if (invokeConvertMillis(formatAttributes, FA_WEEK_OF_YEAR, getWeekOfYearIndex, index)) {</span>
<span class="fc" id="L594">            fmtAttributeIndex[FA_WEEK_OF_YEAR] = index;</span>
        }
<span class="fc" id="L596">    }</span>

    private void assembleParseMethod(
            IntList ops,
            ObjList&lt;String&gt; delimiters,
            int thisClassIndex,
            int stackMapTableIndex,
            int dateLocaleClassIndex,
            int charSequenceClassIndex,
            int minLongIndex,
            int minMillisIndex,
            int matchWeekdayIndex,
            int matchMonthIndex,
            int matchZoneIndex,
            int matchAMPMIndex,
            int matchEraIndex,
            int parseIntSafelyIndex,
            int parseInt000Greedy,
            int decodeLenIndex,
            int decodeIntIndex,
            int assertRemainingIndex,
            int assertNoTailIndex,
            int parseIntIndex,
            int assertStringIndex,
            int assertCharIndex,
            int computeMillisIndex,
            int adjustYearIndex,
            int adjustYearMilleniumIndex,
            int parseYearGreedyIndex,
            int parseOffsetIndex,
            int parseNameIndex,
            int parseSigIndex,
            IntList delimIndices,
            int charAtIndex
    ) {

<span class="fc" id="L632">        int stackState = computeParseMethodStack(ops);</span>

        // public long parse(CharSequence in, int lo, int hi, DateLocale locale) throws NumericException
<span class="fc" id="L635">        asm.startMethod(parseNameIndex, parseSigIndex, 13, 20);</span>

        // define stack variables
        // when pattern is not used a default value must be assigned

<span class="fc bfc" id="L640" title="All 2 branches covered.">        if ((stackState &amp; (1 &lt;&lt; LOCAL_DAY)) == 0) {</span>
            // int day = 1
<span class="fc" id="L642">            asm.iconst(1);</span>
<span class="fc" id="L643">            asm.istore(LOCAL_DAY);</span>
        }

<span class="fc bfc" id="L646" title="All 2 branches covered.">        if ((stackState &amp; (1 &lt;&lt; LOCAL_MONTH)) == 0) {</span>
            // int month = 1
<span class="fc" id="L648">            asm.iconst(1);</span>
<span class="fc" id="L649">            asm.istore(LOCAL_MONTH);</span>
        }

<span class="fc bfc" id="L652" title="All 2 branches covered.">        if ((stackState &amp; (1 &lt;&lt; LOCAL_YEAR)) == 0) {</span>
            // int year = 1970
<span class="fc" id="L654">            asm.iconst(1970);</span>
<span class="fc" id="L655">            asm.istore(LOCAL_YEAR);</span>
        }

<span class="fc bfc" id="L658" title="All 2 branches covered.">        if ((stackState &amp; (1 &lt;&lt; LOCAL_HOUR)) == 0) {</span>
            // int hour = 0
<span class="fc" id="L660">            asm.iconst(0);</span>
<span class="fc" id="L661">            asm.istore(LOCAL_HOUR);</span>
        }

<span class="fc bfc" id="L664" title="All 2 branches covered.">        if ((stackState &amp; (1 &lt;&lt; LOCAL_MINUTE)) == 0) {</span>
            // int minute = 0;
<span class="fc" id="L666">            asm.iconst(0);</span>
<span class="fc" id="L667">            asm.istore(LOCAL_MINUTE);</span>
        }

<span class="fc bfc" id="L670" title="All 2 branches covered.">        if ((stackState &amp; (1 &lt;&lt; LOCAL_SECOND)) == 0) {</span>
            // int second = 0
<span class="fc" id="L672">            asm.iconst(0);</span>
<span class="fc" id="L673">            asm.istore(LOCAL_SECOND);</span>
        }

<span class="fc bfc" id="L676" title="All 2 branches covered.">        if ((stackState &amp; (1 &lt;&lt; LOCAL_MILLIS)) == 0) {</span>
            // int millis = 0
<span class="fc" id="L678">            asm.iconst(0);</span>
<span class="fc" id="L679">            asm.istore(LOCAL_MILLIS);</span>
        }

        // int pos = lo
<span class="fc" id="L683">        asm.iload(P_LO);</span>
<span class="fc" id="L684">        asm.istore(LOCAL_POS);</span>

        // int timezone = -1
<span class="fc" id="L687">        asm.iconst(-1);</span>
<span class="fc" id="L688">        asm.istore(LOCAL_TIMEZONE);</span>

        // long offset = Long.MIN_VALUE
<span class="fc" id="L691">        asm.ldc2_w(minLongIndex);</span>
<span class="fc" id="L692">        asm.lstore(LOCAL_OFFSET);</span>

<span class="fc" id="L694">        asm.iconst(DateFormatUtils.HOUR_24);</span>
<span class="fc" id="L695">        asm.istore(LOCAL_HOUR_TYPE);</span>

<span class="fc bfc" id="L697" title="All 2 branches covered.">        if ((stackState &amp; (1 &lt;&lt; LOCAL_ERA)) == 0) {</span>
<span class="fc" id="L698">            asm.iconst(1);</span>
<span class="fc" id="L699">            asm.istore(LOCAL_ERA);</span>
        }

<span class="fc bfc" id="L702" title="All 2 branches covered.">        if ((stackState &amp; (1 &lt;&lt; LOCAL_TEMP_LONG)) == 0) {</span>
<span class="fc" id="L703">            asm.lconst_0();</span>
<span class="fc" id="L704">            asm.lstore(LOCAL_TEMP_LONG);</span>
        }

<span class="fc" id="L707">        frameOffsets.clear();</span>
<span class="fc bfc" id="L708" title="All 2 branches covered.">        for (int i = 0, n = ops.size(); i &lt; n; i++) {</span>
<span class="fc" id="L709">            int op = ops.getQuick(i);</span>
<span class="fc bfc" id="L710" title="All 40 branches covered.">            switch (op) {</span>
                // AM/PM
                case OP_AM_PM:
<span class="fc" id="L713">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L714">                    invokeMatch(matchAMPMIndex);</span>
<span class="fc" id="L715">                    decodeInt(decodeIntIndex);</span>
<span class="fc" id="L716">                    asm.istore(LOCAL_HOUR_TYPE);</span>
<span class="fc" id="L717">                    addTempToPos(decodeLenIndex);</span>
<span class="fc" id="L718">                    break;</span>
                case OP_MILLIS_ONE_DIGIT:
<span class="fc" id="L720">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_MILLIS);</span>
<span class="fc" id="L721">                    parseDigits(assertRemainingIndex, parseIntIndex, 1, LOCAL_MILLIS);</span>
<span class="fc" id="L722">                    break;</span>
                case OP_MILLIS_THREE_DIGITS:
<span class="fc" id="L724">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_MILLIS);</span>
<span class="fc" id="L725">                    parseDigits(assertRemainingIndex, parseIntIndex, 3, LOCAL_MILLIS);</span>
<span class="fc" id="L726">                    break;</span>
                case OP_MILLIS_GREEDY:
<span class="fc" id="L728">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_MILLIS);</span>
<span class="fc" id="L729">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L730">                    invokeParseIntSafelyAndStore(parseInt000Greedy, decodeLenIndex, decodeIntIndex, LOCAL_MILLIS);</span>
<span class="fc" id="L731">                    break;</span>
                case OP_SECOND_ONE_DIGIT:
<span class="fc" id="L733">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_SECOND);</span>
<span class="fc" id="L734">                    parseDigits(assertRemainingIndex, parseIntIndex, 1, LOCAL_SECOND);</span>
<span class="fc" id="L735">                    break;</span>
                case OP_SECOND_TWO_DIGITS:
<span class="fc" id="L737">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_SECOND);</span>
<span class="fc" id="L738">                    parseTwoDigits(assertRemainingIndex, parseIntIndex, LOCAL_SECOND);</span>
<span class="fc" id="L739">                    break;</span>
                case OP_SECOND_GREEDY:
<span class="fc" id="L741">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_SECOND);</span>
<span class="fc" id="L742">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L743">                    invokeParseIntSafelyAndStore(parseIntSafelyIndex, decodeLenIndex, decodeIntIndex, LOCAL_SECOND);</span>
<span class="fc" id="L744">                    break;</span>
                case OP_MINUTE_ONE_DIGIT:
<span class="fc" id="L746">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_MINUTE);</span>
<span class="fc" id="L747">                    parseDigits(assertRemainingIndex, parseIntIndex, 1, LOCAL_MINUTE);</span>
<span class="fc" id="L748">                    break;</span>
                case OP_MINUTE_TWO_DIGITS:
<span class="fc" id="L750">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_MINUTE);</span>
<span class="fc" id="L751">                    parseTwoDigits(assertRemainingIndex, parseIntIndex, LOCAL_MINUTE);</span>
<span class="fc" id="L752">                    break;</span>

                case OP_MINUTE_GREEDY:
<span class="fc" id="L755">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_MINUTE);</span>
<span class="fc" id="L756">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L757">                    invokeParseIntSafelyAndStore(parseIntSafelyIndex, decodeLenIndex, decodeIntIndex, LOCAL_MINUTE);</span>
<span class="fc" id="L758">                    break;</span>
                // HOUR (0-11)
                case OP_HOUR_12_ONE_DIGIT:
<span class="fc" id="L761">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L762">                    parseDigits(assertRemainingIndex, parseIntIndex, 1, LOCAL_HOUR);</span>
<span class="fc" id="L763">                    setHourType(stackState);</span>
<span class="fc" id="L764">                    break;</span>
                case OP_HOUR_12_TWO_DIGITS:
<span class="fc" id="L766">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L767">                    parseTwoDigits(assertRemainingIndex, parseIntIndex, LOCAL_HOUR);</span>
<span class="fc" id="L768">                    setHourType(stackState);</span>
<span class="fc" id="L769">                    break;</span>

                case OP_HOUR_12_GREEDY:
<span class="fc" id="L772">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L773">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L774">                    invokeParseIntSafelyAndStore(parseIntSafelyIndex, decodeLenIndex, decodeIntIndex, LOCAL_HOUR);</span>
<span class="fc" id="L775">                    setHourType(stackState);</span>
<span class="fc" id="L776">                    break;</span>
                // HOUR (1-12)
                case OP_HOUR_12_ONE_DIGIT_ONE_BASED:
<span class="fc" id="L779">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L780">                    parseDigitsSub1(assertRemainingIndex, parseIntIndex, 1);</span>
<span class="fc" id="L781">                    setHourType(stackState);</span>
<span class="fc" id="L782">                    break;</span>

                case OP_HOUR_12_TWO_DIGITS_ONE_BASED:
<span class="fc" id="L785">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L786">                    parseDigitsSub1(assertRemainingIndex, parseIntIndex, 2);</span>
<span class="fc" id="L787">                    setHourType(stackState);</span>
<span class="fc" id="L788">                    break;</span>

                case OP_HOUR_12_GREEDY_ONE_BASED:
<span class="fc" id="L791">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L792">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>

<span class="fc" id="L794">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L795">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L796">                    asm.iload(P_HI);</span>
<span class="fc" id="L797">                    asm.invokeStatic(parseIntSafelyIndex);</span>
<span class="fc" id="L798">                    asm.lstore(LOCAL_TEMP_LONG);</span>
<span class="fc" id="L799">                    decodeInt(decodeIntIndex);</span>
<span class="fc" id="L800">                    asm.iconst(1);</span>
<span class="fc" id="L801">                    asm.isub();</span>
<span class="fc" id="L802">                    asm.istore(LOCAL_HOUR);</span>
<span class="fc" id="L803">                    addTempToPos(decodeLenIndex);</span>
<span class="fc" id="L804">                    setHourType(stackState);</span>
<span class="fc" id="L805">                    break;</span>
                // HOUR (0-23)
                case OP_HOUR_24_ONE_DIGIT:
<span class="fc" id="L808">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L809">                    parseDigits(assertRemainingIndex, parseIntIndex, 1, LOCAL_HOUR);</span>
<span class="fc" id="L810">                    break;</span>

                case OP_HOUR_24_TWO_DIGITS:
<span class="fc" id="L813">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L814">                    parseTwoDigits(assertRemainingIndex, parseIntIndex, LOCAL_HOUR);</span>
<span class="fc" id="L815">                    break;</span>

                case OP_HOUR_24_GREEDY:
<span class="fc" id="L818">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L819">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L820">                    invokeParseIntSafelyAndStore(parseIntSafelyIndex, decodeLenIndex, decodeIntIndex, LOCAL_HOUR);</span>
<span class="fc" id="L821">                    break;</span>
                // HOUR (1 - 24)
                case OP_HOUR_24_ONE_DIGIT_ONE_BASED:
<span class="fc" id="L824">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L825">                    parseDigitsSub1(assertRemainingIndex, parseIntIndex, 1);</span>
<span class="fc" id="L826">                    break;</span>

                case OP_HOUR_24_TWO_DIGITS_ONE_BASED:
<span class="fc" id="L829">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L830">                    parseDigitsSub1(assertRemainingIndex, parseIntIndex, 2);</span>
<span class="fc" id="L831">                    break;</span>

                case OP_HOUR_24_GREEDY_ONE_BASED:
<span class="fc" id="L834">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L835">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>

<span class="fc" id="L837">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L838">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L839">                    asm.iload(P_HI);</span>
<span class="fc" id="L840">                    asm.invokeStatic(parseIntSafelyIndex);</span>
<span class="fc" id="L841">                    asm.lstore(LOCAL_TEMP_LONG);</span>
<span class="fc" id="L842">                    decodeInt(decodeIntIndex);</span>
<span class="fc" id="L843">                    asm.iconst(1);</span>
<span class="fc" id="L844">                    asm.isub();</span>
<span class="fc" id="L845">                    asm.istore(LOCAL_HOUR);</span>
<span class="fc" id="L846">                    addTempToPos(decodeLenIndex);</span>
<span class="fc" id="L847">                    break;</span>
                // DAY
                case OP_DAY_ONE_DIGIT:
<span class="fc" id="L850">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_DAY);</span>
<span class="fc" id="L851">                    parseDigits(assertRemainingIndex, parseIntIndex, 1, LOCAL_DAY);</span>
<span class="fc" id="L852">                    break;</span>
                case OP_DAY_TWO_DIGITS:
<span class="fc" id="L854">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_DAY);</span>
<span class="fc" id="L855">                    parseTwoDigits(assertRemainingIndex, parseIntIndex, LOCAL_DAY);</span>
<span class="fc" id="L856">                    break;</span>
                case OP_DAY_GREEDY:
<span class="fc" id="L858">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_DAY);</span>
<span class="fc" id="L859">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L860">                    invokeParseIntSafelyAndStore(parseIntSafelyIndex, decodeLenIndex, decodeIntIndex, LOCAL_DAY);</span>
<span class="fc" id="L861">                    break;</span>
                case OP_DAY_NAME_LONG:
                case OP_DAY_NAME_SHORT:
<span class="fc" id="L864">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L865">                    invokeMatch(matchWeekdayIndex);</span>
<span class="fc" id="L866">                    addTempToPos(decodeLenIndex);</span>
<span class="fc" id="L867">                    break;</span>
                case OP_WEEK_OF_YEAR:
                case OP_DAY_OF_YEAR:
<span class="fc" id="L870">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L871">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L872">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L873">                    asm.iload(P_HI);</span>
<span class="fc" id="L874">                    asm.invokeStatic(parseIntSafelyIndex);</span>
<span class="fc" id="L875">                    asm.lstore(LOCAL_TEMP_LONG);</span>
<span class="fc" id="L876">                    addTempToPos(decodeLenIndex);</span>
<span class="fc" id="L877">                    break;</span>
                case OP_WEEK_OF_MONTH:
                case OP_DAY_OF_WEEK:
<span class="fc" id="L880">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L881">                    asm.iload(P_HI);</span>
<span class="fc" id="L882">                    asm.invokeStatic(assertRemainingIndex);</span>

<span class="fc" id="L884">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L885">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L886">                    asm.iinc(LOCAL_POS, 1);</span>
<span class="fc" id="L887">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L888">                    asm.invokeStatic(parseIntIndex);</span>
<span class="fc" id="L889">                    asm.pop();</span>
<span class="fc" id="L890">                    break;</span>

                case OP_MONTH_ONE_DIGIT:
<span class="fc" id="L893">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_MONTH);</span>
<span class="fc" id="L894">                    parseDigits(assertRemainingIndex, parseIntIndex, 1, LOCAL_MONTH);</span>
<span class="fc" id="L895">                    break;</span>
                case OP_MONTH_TWO_DIGITS:
<span class="fc" id="L897">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_MONTH);</span>
<span class="fc" id="L898">                    parseTwoDigits(assertRemainingIndex, parseIntIndex, LOCAL_MONTH);</span>
<span class="fc" id="L899">                    break;</span>
                case OP_MONTH_GREEDY:
<span class="fc" id="L901">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_MONTH);</span>
<span class="fc" id="L902">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L903">                    invokeParseIntSafelyAndStore(parseIntSafelyIndex, decodeLenIndex, decodeIntIndex, LOCAL_MONTH);</span>
<span class="fc" id="L904">                    break;</span>

                case OP_MONTH_SHORT_NAME:
                case OP_MONTH_LONG_NAME:
<span class="fc" id="L908">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_MONTH);</span>
<span class="fc" id="L909">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>

<span class="fc" id="L911">                    invokeMatch(matchMonthIndex);</span>
<span class="fc" id="L912">                    decodeInt(decodeIntIndex);</span>
<span class="fc" id="L913">                    asm.iconst(1);</span>
<span class="fc" id="L914">                    asm.iadd();</span>
<span class="fc" id="L915">                    asm.istore(LOCAL_MONTH);</span>
<span class="fc" id="L916">                    addTempToPos(decodeLenIndex);</span>
<span class="fc" id="L917">                    break;</span>

                case OP_YEAR_ONE_DIGIT:
<span class="fc" id="L920">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_YEAR);</span>
<span class="fc" id="L921">                    parseDigits(assertRemainingIndex, parseIntIndex, 1, LOCAL_YEAR);</span>
<span class="fc" id="L922">                    break;</span>
                case OP_YEAR_TWO_DIGITS:
<span class="fc" id="L924">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_YEAR);</span>

<span class="fc" id="L926">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L927">                    asm.iconst(1);</span>
<span class="fc" id="L928">                    asm.iadd();</span>
<span class="fc" id="L929">                    asm.iload(P_HI);</span>
<span class="fc" id="L930">                    asm.invokeStatic(assertRemainingIndex);</span>

<span class="fc" id="L932">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L933">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L934">                    asm.iinc(LOCAL_POS, 2);</span>
<span class="fc" id="L935">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L936">                    asm.invokeStatic(parseIntIndex);</span>
<span class="fc" id="L937">                    asm.invokeStatic(adjustYearIndex);</span>
<span class="fc" id="L938">                    asm.istore(LOCAL_YEAR);</span>
<span class="fc" id="L939">                    break;</span>
                case OP_YEAR_THREE_DIGITS:
<span class="fc" id="L941">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_YEAR);</span>

<span class="fc" id="L943">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L944">                    asm.iconst(2);</span>
<span class="fc" id="L945">                    asm.iadd();</span>
<span class="fc" id="L946">                    asm.iload(P_HI);</span>
<span class="fc" id="L947">                    asm.invokeStatic(assertRemainingIndex);</span>

<span class="fc" id="L949">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L950">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L951">                    asm.iinc(LOCAL_POS, 3);</span>
<span class="fc" id="L952">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L953">                    asm.invokeStatic(parseIntIndex);</span>
<span class="fc" id="L954">                    asm.invokeStatic(adjustYearMilleniumIndex);</span>
<span class="fc" id="L955">                    asm.istore(LOCAL_YEAR);</span>
<span class="fc" id="L956">                    break;</span>
                case OP_YEAR_FOUR_DIGITS: {
<span class="fc" id="L958">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L959">                    asm.iload(P_HI);</span>
<span class="fc" id="L960">                    int b1 = asm.if_icmpge();</span>
<span class="fc" id="L961">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L962">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L963">                    asm.invokeInterface(charAtIndex, 1); //charAt</span>
<span class="fc" id="L964">                    asm.iconst('-');</span>
<span class="fc" id="L965">                    int b2 = asm.if_icmpne();</span>
<span class="fc" id="L966">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L967">                    asm.iconst(4);</span>
<span class="fc" id="L968">                    asm.iadd();</span>
<span class="fc" id="L969">                    asm.iload(P_HI);</span>
<span class="fc" id="L970">                    asm.invokeStatic(assertRemainingIndex);</span>
<span class="fc" id="L971">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L972">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L973">                    asm.iconst(1);</span>
<span class="fc" id="L974">                    asm.iadd();</span>
<span class="fc" id="L975">                    asm.iinc(LOCAL_POS, 5);</span>
<span class="fc" id="L976">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L977">                    asm.invokeStatic(parseIntIndex);</span>
<span class="fc" id="L978">                    asm.ineg();</span>
<span class="fc" id="L979">                    asm.istore(LOCAL_YEAR);</span>
<span class="fc" id="L980">                    int b3 = asm.goto_();</span>

<span class="fc" id="L982">                    int p = asm.position();</span>
<span class="fc" id="L983">                    frameOffsets.add(Numbers.encodeLowHighInts(stackState, p));</span>
<span class="fc" id="L984">                    asm.setJmp(b1, p);</span>
<span class="fc" id="L985">                    asm.setJmp(b2, p);</span>

<span class="fc" id="L987">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L988">                    asm.iconst(3);</span>
<span class="fc" id="L989">                    asm.iadd();</span>
<span class="fc" id="L990">                    asm.iload(P_HI);</span>
<span class="fc" id="L991">                    asm.invokeStatic(assertRemainingIndex);</span>

<span class="fc" id="L993">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L994">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L995">                    asm.iinc(LOCAL_POS, 4);</span>
<span class="fc" id="L996">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L997">                    asm.invokeStatic(parseIntIndex);</span>
<span class="fc" id="L998">                    asm.istore(LOCAL_YEAR);</span>

<span class="fc" id="L1000">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_YEAR);</span>

<span class="fc" id="L1002">                    p = asm.position();</span>
<span class="fc" id="L1003">                    frameOffsets.add(Numbers.encodeLowHighInts(stackState, p));</span>
<span class="fc" id="L1004">                    asm.setJmp(b3, p);</span>
                }
<span class="fc" id="L1006">                break;</span>
                case OP_YEAR_GREEDY:
<span class="fc" id="L1008">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_YEAR);</span>
<span class="fc" id="L1009">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>

<span class="fc" id="L1011">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L1012">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1013">                    asm.iload(P_HI);</span>
<span class="fc" id="L1014">                    asm.invokeStatic(parseYearGreedyIndex);</span>
<span class="fc" id="L1015">                    asm.lstore(LOCAL_TEMP_LONG);</span>
<span class="fc" id="L1016">                    decodeInt(decodeIntIndex);</span>
<span class="fc" id="L1017">                    asm.istore(LOCAL_YEAR);</span>
<span class="fc" id="L1018">                    addTempToPos(decodeLenIndex);</span>
<span class="fc" id="L1019">                    break;</span>
                case OP_ERA:
<span class="fc" id="L1021">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_ERA);</span>

<span class="fc" id="L1023">                    invokeMatch(matchEraIndex);</span>
<span class="fc" id="L1024">                    decodeInt(decodeIntIndex);</span>
<span class="fc" id="L1025">                    asm.istore(LOCAL_ERA);</span>
<span class="fc" id="L1026">                    addTempToPos(decodeLenIndex);</span>
<span class="fc" id="L1027">                    break;</span>
                case OP_TIME_ZONE_SHORT:
                case OP_TIME_ZONE_GMT_BASED:
                case OP_TIME_ZONE_ISO_8601_1:
                case OP_TIME_ZONE_ISO_8601_2:
                case OP_TIME_ZONE_ISO_8601_3:
                case OP_TIME_ZONE_LONG:
                case OP_TIME_ZONE_RFC_822:
<span class="fc" id="L1035">                    stackState &amp;= ~(1 &lt;&lt; LOCAL_TEMP_LONG);</span>

<span class="fc" id="L1037">                    asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L1038">                    asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1039">                    asm.iload(P_HI);</span>
<span class="fc" id="L1040">                    asm.invokeStatic(parseOffsetIndex);</span>
<span class="fc" id="L1041">                    asm.lstore(LOCAL_TEMP_LONG);</span>

<span class="fc" id="L1043">                    asm.lload(LOCAL_TEMP_LONG);</span>
<span class="fc" id="L1044">                    asm.ldc2_w(minLongIndex);</span>
<span class="fc" id="L1045">                    asm.lcmp();</span>
<span class="fc" id="L1046">                    int branch1 = asm.ifne();</span>

                    //
<span class="fc" id="L1049">                    invokeMatch(matchZoneIndex);</span>
                    //
<span class="fc" id="L1051">                    decodeInt(decodeIntIndex);</span>
<span class="fc" id="L1052">                    asm.istore(LOCAL_TIMEZONE);</span>
<span class="fc" id="L1053">                    int branch2 = asm.goto_();</span>

<span class="fc" id="L1055">                    int p = asm.position();</span>
<span class="fc" id="L1056">                    frameOffsets.add(Numbers.encodeLowHighInts(stackState, p));</span>
<span class="fc" id="L1057">                    asm.setJmp(branch1, p);</span>

<span class="fc" id="L1059">                    decodeInt(decodeIntIndex);</span>
<span class="fc" id="L1060">                    asm.i2l();</span>
<span class="fc" id="L1061">                    asm.ldc2_w(minMillisIndex);</span>
<span class="fc" id="L1062">                    asm.lmul();</span>
<span class="fc" id="L1063">                    asm.lstore(LOCAL_OFFSET);</span>
<span class="fc" id="L1064">                    p = asm.position();</span>
<span class="fc" id="L1065">                    frameOffsets.add(Numbers.encodeLowHighInts(stackState, p));</span>
<span class="fc" id="L1066">                    asm.setJmp(branch2, p);</span>
<span class="fc" id="L1067">                    addTempToPos(decodeLenIndex);</span>
<span class="fc" id="L1068">                    break;</span>
                default:
<span class="fc" id="L1070">                    String delimiter = delimiters.getQuick(-op - 1);</span>
<span class="fc" id="L1071">                    int len = delimiter.length();</span>
<span class="fc bfc" id="L1072" title="All 2 branches covered.">                    if (len == 1) {</span>
                        // TimestampFormatUtils.assertChar(' ', in, pos++, hi);
<span class="fc" id="L1074">                        asm.iconst(delimiter.charAt(0));</span>
<span class="fc" id="L1075">                        asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L1076">                        asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1077">                        asm.iinc(LOCAL_POS, 1);</span>
<span class="fc" id="L1078">                        asm.iload(P_HI);</span>
<span class="fc" id="L1079">                        asm.invokeStatic(assertCharIndex);</span>
                    } else {
                        // pos = TimestampFormatUtils.assertString(&quot;, &quot;, 2, in, pos, hi);
<span class="fc" id="L1082">                        asm.ldc(delimIndices.getQuick(-op - 1));</span>
<span class="fc" id="L1083">                        asm.iconst(len);</span>
<span class="fc" id="L1084">                        asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L1085">                        asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1086">                        asm.iload(P_HI);</span>
<span class="fc" id="L1087">                        asm.invokeStatic(assertStringIndex);</span>
<span class="fc" id="L1088">                        asm.istore(LOCAL_POS);</span>
                    }
                    break;
            }
        }

        // check that there is no tail
<span class="fc" id="L1095">        asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1096">        asm.iload(P_HI);</span>
<span class="fc" id="L1097">        asm.invokeStatic(assertNoTailIndex);</span>
<span class="fc" id="L1098">        asm.aload(P_LOCALE);</span>
<span class="fc" id="L1099">        asm.iload(LOCAL_ERA);</span>
<span class="fc" id="L1100">        asm.iload(LOCAL_YEAR);</span>
<span class="fc" id="L1101">        asm.iload(LOCAL_MONTH);</span>
<span class="fc" id="L1102">        asm.iload(LOCAL_DAY);</span>
<span class="fc" id="L1103">        asm.iload(LOCAL_HOUR);</span>
<span class="fc" id="L1104">        asm.iload(LOCAL_MINUTE);</span>
<span class="fc" id="L1105">        asm.iload(LOCAL_SECOND);</span>
<span class="fc" id="L1106">        asm.iload(LOCAL_MILLIS);</span>
<span class="fc" id="L1107">        asm.iload(LOCAL_TIMEZONE);</span>
<span class="fc" id="L1108">        asm.lload(LOCAL_OFFSET);</span>
<span class="fc" id="L1109">        asm.iload(LOCAL_HOUR_TYPE);</span>
<span class="fc" id="L1110">        asm.invokeStatic(computeMillisIndex);</span>
<span class="fc" id="L1111">        asm.lreturn();</span>
<span class="fc" id="L1112">        asm.endMethodCode();</span>

        // exceptions
<span class="fc" id="L1115">        asm.putShort(0);</span>
        // attributes
<span class="fc" id="L1117">        int n = frameOffsets.size();</span>
<span class="fc bfc" id="L1118" title="All 2 branches covered.">        asm.putShort(n &gt; 0 ? 1 : 0);</span>
<span class="fc bfc" id="L1119" title="All 2 branches covered.">        if (n &gt; 0) {</span>
<span class="fc" id="L1120">            asm.startStackMapTables(stackMapTableIndex, n);</span>

<span class="fc" id="L1122">            int prevStackState = 0;</span>
<span class="fc" id="L1123">            int start = asm.getCodeStart();</span>

<span class="fc bfc" id="L1125" title="All 2 branches covered.">            for (int i = 0; i &lt; n; i++) {</span>
<span class="fc" id="L1126">                long l = frameOffsets.getQuick(i);</span>
<span class="fc" id="L1127">                int offset = Numbers.decodeHighInt(l);</span>
<span class="fc" id="L1128">                int ss = Numbers.decodeLowInt(l);</span>

<span class="fc bfc" id="L1130" title="All 4 branches covered.">                if (i == 0 || prevStackState != ss) {</span>
<span class="fc" id="L1131">                    asm.full_frame(offset - start);</span>
                    // 18 local variables
<span class="fc" id="L1133">                    int countPos = asm.position();</span>
<span class="fc" id="L1134">                    int count = 18;</span>
<span class="fc" id="L1135">                    asm.putShort(0);</span>

<span class="fc" id="L1137">                    asm.putITEM_Object(thisClassIndex);</span>
<span class="fc" id="L1138">                    asm.putITEM_Object(charSequenceClassIndex);</span>
<span class="fc" id="L1139">                    asm.putITEM_Integer();</span>
<span class="fc" id="L1140">                    asm.putITEM_Integer();</span>
<span class="fc" id="L1141">                    asm.putITEM_Object(dateLocaleClassIndex);</span>


<span class="fc bfc" id="L1144" title="All 2 branches covered.">                    if ((ss &amp; (1 &lt;&lt; LOCAL_DAY)) == 0) {</span>
<span class="fc" id="L1145">                        asm.putITEM_Integer();</span>
                    } else {
<span class="fc" id="L1147">                        asm.putITEM_Top();</span>
                    }

<span class="fc bfc" id="L1150" title="All 2 branches covered.">                    if ((ss &amp; (1 &lt;&lt; LOCAL_MONTH)) == 0) {</span>
<span class="fc" id="L1151">                        asm.putITEM_Integer();</span>
                    } else {
<span class="fc" id="L1153">                        asm.putITEM_Top();</span>
                    }

<span class="fc bfc" id="L1156" title="All 2 branches covered.">                    if ((ss &amp; (1 &lt;&lt; LOCAL_YEAR)) == 0) {</span>
<span class="fc" id="L1157">                        asm.putITEM_Integer();</span>
                    } else {
<span class="fc" id="L1159">                        asm.putITEM_Top();</span>
                    }

<span class="fc bfc" id="L1162" title="All 2 branches covered.">                    if ((ss &amp; (1 &lt;&lt; LOCAL_HOUR)) == 0) {</span>
<span class="fc" id="L1163">                        asm.putITEM_Integer();</span>
                    } else {
<span class="fc" id="L1165">                        asm.putITEM_Top();</span>
                    }

<span class="fc bfc" id="L1168" title="All 2 branches covered.">                    if ((ss &amp; (1 &lt;&lt; LOCAL_MINUTE)) == 0) {</span>
<span class="fc" id="L1169">                        asm.putITEM_Integer();</span>
                    } else {
<span class="fc" id="L1171">                        asm.putITEM_Top();</span>
                    }

<span class="fc bfc" id="L1174" title="All 2 branches covered.">                    if ((ss &amp; (1 &lt;&lt; LOCAL_SECOND)) == 0) {</span>
<span class="fc" id="L1175">                        asm.putITEM_Integer();</span>
                    } else {
<span class="fc" id="L1177">                        asm.putITEM_Top();</span>
                    }

<span class="fc bfc" id="L1180" title="All 2 branches covered.">                    if ((ss &amp; (1 &lt;&lt; LOCAL_MILLIS)) == 0) {</span>
<span class="fc" id="L1181">                        asm.putITEM_Integer();</span>
                    } else {
<span class="fc" id="L1183">                        asm.putITEM_Top();</span>
                    }

                    // LOCAL_POS is always set
<span class="fc" id="L1187">                    asm.putITEM_Integer();</span>


<span class="fc bfc" id="L1190" title="All 2 branches covered.">                    if ((ss &amp; (1 &lt;&lt; LOCAL_TEMP_LONG)) == 0) {</span>
<span class="fc" id="L1191">                        asm.putITEM_Long();</span>
                    } else {
<span class="fc" id="L1193">                        asm.putITEM_Top();</span>
<span class="fc" id="L1194">                        asm.putITEM_Top();</span>
<span class="fc" id="L1195">                        count++;</span>
                    }

                    // LOCAL_TIMEZONE is always set
<span class="fc" id="L1199">                    asm.putITEM_Integer();</span>

                    // LOCAL_OFFSET
<span class="fc" id="L1202">                    asm.putITEM_Long();</span>

                    // LOCAL_HOUR_TYPE
<span class="fc" id="L1205">                    asm.putITEM_Integer();</span>

<span class="fc bfc" id="L1207" title="All 2 branches covered.">                    if ((ss &amp; (1 &lt;&lt; LOCAL_ERA)) == 0) {</span>
<span class="fc" id="L1208">                        asm.putITEM_Integer();</span>
                    } else {
<span class="fc" id="L1210">                        asm.putITEM_Top();</span>
                    }

<span class="fc" id="L1213">                    asm.putShort(countPos, count);</span>

                    // 0 stack
<span class="fc" id="L1216">                    asm.putShort(0);</span>
<span class="fc" id="L1217">                    prevStackState = ss;</span>
<span class="fc" id="L1218">                } else {</span>
<span class="fc" id="L1219">                    asm.same_frame(offset - start);</span>
                }
<span class="fc" id="L1221">                start = offset + 1;</span>
            }
<span class="fc" id="L1223">            asm.endStackMapTables();</span>
        }

<span class="fc" id="L1226">        asm.endMethod();</span>
<span class="fc" id="L1227">    }</span>

    /**
     * Bytecode is assembled from fragments of switch() statement in GenericDateFormat. Compilation removes loop/switch
     * and does not include code that wouldn't be relevant for the given pattern. Main performance benefit however comes
     * from removing redundant local variable initialization code. For example year has to be defaulted to 1970 when
     * it isn't present in the pattern and does not have to be defaulted at all when it is.
     */
    private DateFormat compile(IntList ops, ObjList&lt;String&gt; delimiters) {
<span class="fc" id="L1236">        asm.init(DateFormat.class);</span>
<span class="fc" id="L1237">        asm.setupPool();</span>
<span class="fc" id="L1238">        int thisClassIndex = asm.poolClass(asm.poolUtf8(&quot;io/questdb/std/datetime/DateFormatAsm&quot;));</span>
<span class="fc" id="L1239">        int stackMapTableIndex = asm.poolUtf8(&quot;StackMapTable&quot;);</span>
<span class="fc" id="L1240">        int superclassIndex = asm.poolClass(AbstractDateFormat.class);</span>
<span class="fc" id="L1241">        int dateLocaleClassIndex = asm.poolClass(DateLocale.class);</span>
<span class="fc" id="L1242">        int charSequenceClassIndex = asm.poolClass(CharSequence.class);</span>
<span class="fc" id="L1243">        int minLongIndex = asm.poolLongConst(Long.MIN_VALUE);</span>
<span class="fc" id="L1244">        int minMillisIndex = asm.poolLongConst(Dates.MINUTE_MILLIS);</span>

<span class="fc" id="L1246">        int superIndex = asm.poolMethod(superclassIndex, &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span>
<span class="fc" id="L1247">        int matchWeekdayIndex = asm.poolMethod(DateLocale.class, &quot;matchWeekday&quot;, &quot;(Ljava/lang/CharSequence;II)J&quot;);</span>
<span class="fc" id="L1248">        int matchMonthIndex = asm.poolMethod(DateLocale.class, &quot;matchMonth&quot;, &quot;(Ljava/lang/CharSequence;II)J&quot;);</span>
<span class="fc" id="L1249">        int matchZoneIndex = asm.poolMethod(DateLocale.class, &quot;matchZone&quot;, &quot;(Ljava/lang/CharSequence;II)J&quot;);</span>
<span class="fc" id="L1250">        int matchAMPMIndex = asm.poolMethod(DateLocale.class, &quot;matchAMPM&quot;, &quot;(Ljava/lang/CharSequence;II)J&quot;);</span>
<span class="fc" id="L1251">        int matchEraIndex = asm.poolMethod(DateLocale.class, &quot;matchEra&quot;, &quot;(Ljava/lang/CharSequence;II)J&quot;);</span>
<span class="fc" id="L1252">        int getWeekdayIndex = asm.poolMethod(DateLocale.class, &quot;getWeekday&quot;, &quot;(I)Ljava/lang/String;&quot;);</span>
<span class="fc" id="L1253">        int getShortWeekdayIndex = asm.poolMethod(DateLocale.class, &quot;getShortWeekday&quot;, &quot;(I)Ljava/lang/String;&quot;);</span>
<span class="fc" id="L1254">        int getMonthIndex = asm.poolMethod(DateLocale.class, &quot;getMonth&quot;, &quot;(I)Ljava/lang/String;&quot;);</span>
<span class="fc" id="L1255">        int getShortMonthIndex = asm.poolMethod(DateLocale.class, &quot;getShortMonth&quot;, &quot;(I)Ljava/lang/String;&quot;);</span>

<span class="fc" id="L1257">        int parseIntSafelyIndex = asm.poolMethod(Numbers.class, &quot;parseIntSafely&quot;, &quot;(Ljava/lang/CharSequence;II)J&quot;);</span>
<span class="fc" id="L1258">        int parseInt000Greedy = asm.poolMethod(Numbers.class, &quot;parseInt000Greedy&quot;, &quot;(Ljava/lang/CharSequence;II)J&quot;);</span>
<span class="fc" id="L1259">        int decodeLenIndex = asm.poolMethod(Numbers.class, &quot;decodeHighInt&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L1260">        int decodeIntIndex = asm.poolMethod(Numbers.class, &quot;decodeLowInt&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L1261">        int parseIntIndex = asm.poolMethod(Numbers.class, &quot;parseInt&quot;, &quot;(Ljava/lang/CharSequence;II)I&quot;);</span>

<span class="fc" id="L1263">        int assertRemainingIndex = asm.poolMethod(DateFormatUtils.class, &quot;assertRemaining&quot;, &quot;(II)V&quot;);</span>
<span class="fc" id="L1264">        int assertNoTailIndex = asm.poolMethod(DateFormatUtils.class, &quot;assertNoTail&quot;, &quot;(II)V&quot;);</span>
<span class="fc" id="L1265">        int assertStringIndex = asm.poolMethod(DateFormatUtils.class, &quot;assertString&quot;, &quot;(Ljava/lang/CharSequence;ILjava/lang/CharSequence;II)I&quot;);</span>
<span class="fc" id="L1266">        int assertCharIndex = asm.poolMethod(DateFormatUtils.class, &quot;assertChar&quot;, &quot;(CLjava/lang/CharSequence;II)V&quot;);</span>
<span class="fc" id="L1267">        int computeMillisIndex = asm.poolMethod(DateFormatUtils.class, &quot;compute&quot;, &quot;(Lio/questdb/std/datetime/DateLocale;IIIIIIIIIJI)J&quot;);</span>
<span class="fc" id="L1268">        int adjustYearIndex = asm.poolMethod(DateFormatUtils.class, &quot;adjustYear&quot;, &quot;(I)I&quot;);</span>
<span class="fc" id="L1269">        int adjustYearMilleniumIndex = asm.poolMethod(DateFormatUtils.class, &quot;adjustYearMillenium&quot;, &quot;(I)I&quot;);</span>
<span class="fc" id="L1270">        int parseYearGreedyIndex = asm.poolMethod(DateFormatUtils.class, &quot;parseYearGreedy&quot;, &quot;(Ljava/lang/CharSequence;II)J&quot;);</span>
<span class="fc" id="L1271">        int appendEraIndex = asm.poolMethod(DateFormatUtils.class, &quot;appendEra&quot;, &quot;(Lio/questdb/std/str/CharSink;ILio/questdb/std/datetime/DateLocale;)V&quot;);</span>
<span class="fc" id="L1272">        int appendAmPmIndex = asm.poolMethod(DateFormatUtils.class, &quot;appendAmPm&quot;, &quot;(Lio/questdb/std/str/CharSink;ILio/questdb/std/datetime/DateLocale;)V&quot;);</span>
<span class="fc" id="L1273">        int appendHour12Index = asm.poolMethod(DateFormatUtils.class, &quot;appendHour12&quot;, &quot;(Lio/questdb/std/str/CharSink;I)V&quot;);</span>
<span class="fc" id="L1274">        int appendHour12PaddedIndex = asm.poolMethod(DateFormatUtils.class, &quot;appendHour12Padded&quot;, &quot;(Lio/questdb/std/str/CharSink;I)V&quot;);</span>
<span class="fc" id="L1275">        int appendHour121Index = asm.poolMethod(DateFormatUtils.class, &quot;appendHour121&quot;, &quot;(Lio/questdb/std/str/CharSink;I)V&quot;);</span>
<span class="fc" id="L1276">        int appendHour121PaddedIndex = asm.poolMethod(DateFormatUtils.class, &quot;appendHour121Padded&quot;, &quot;(Lio/questdb/std/str/CharSink;I)V&quot;);</span>
<span class="fc" id="L1277">        int appendYear000Index = asm.poolMethod(TimestampFormatUtils.class, &quot;appendYear000&quot;, &quot;(Lio/questdb/std/str/CharSink;I)V&quot;);</span>
<span class="fc" id="L1278">        int append00Index = asm.poolMethod(DateFormatUtils.class, &quot;append00&quot;, &quot;(Lio/questdb/std/str/CharSink;I)V&quot;);</span>
<span class="fc" id="L1279">        int append0Index = asm.poolMethod(DateFormatUtils.class, &quot;append0&quot;, &quot;(Lio/questdb/std/str/CharSink;I)V&quot;);</span>

<span class="fc" id="L1281">        int parseOffsetIndex = asm.poolMethod(Dates.class, &quot;parseOffset&quot;, &quot;(Ljava/lang/CharSequence;II)J&quot;);</span>
<span class="fc" id="L1282">        int getYearIndex = asm.poolMethod(Dates.class, &quot;getYear&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L1283">        int isLeapYearIndex = asm.poolMethod(Dates.class, &quot;isLeapYear&quot;, &quot;(I)Z&quot;);</span>
<span class="fc" id="L1284">        int getMonthOfYearIndex = asm.poolMethod(Dates.class, &quot;getMonthOfYear&quot;, &quot;(JIZ)I&quot;);</span>
<span class="fc" id="L1285">        int getDayOfMonthIndex = asm.poolMethod(Dates.class, &quot;getDayOfMonth&quot;, &quot;(JIIZ)I&quot;);</span>
<span class="fc" id="L1286">        int getHourOfDayIndex = asm.poolMethod(Dates.class, &quot;getHourOfDay&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L1287">        int getMinuteOfHourIndex = asm.poolMethod(Dates.class, &quot;getMinuteOfHour&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L1288">        int getSecondOfMinuteIndex = asm.poolMethod(Dates.class, &quot;getSecondOfMinute&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L1289">        int getMillisOfSecondIndex = asm.poolMethod(Dates.class, &quot;getMillisOfSecond&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L1290">        int getDayOfWeekIndex = asm.poolMethod(Dates.class, &quot;getDayOfWeekSundayFirst&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L1291">        int getDayOfYearIndex = asm.poolMethod(Dates.class, &quot;getDayOfYear&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L1292">        int getWeekOfMonthIndex = asm.poolMethod(Dates.class, &quot;getWeekOfMonth&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L1293">        int getWeekOfYearIndex = asm.poolMethod(Dates.class, &quot;getWeekOfYear&quot;, &quot;(J)I&quot;);</span>

<span class="fc" id="L1295">        int sinkPutIntIndex = asm.poolInterfaceMethod(CharSink.class, &quot;put&quot;, &quot;(I)Lio/questdb/std/str/CharSink;&quot;);</span>
<span class="fc" id="L1296">        int sinkPutStrIndex = asm.poolInterfaceMethod(CharSink.class, &quot;put&quot;, &quot;(Ljava/lang/CharSequence;)Lio/questdb/std/str/CharSink;&quot;);</span>
<span class="fc" id="L1297">        int sinkPutChrIndex = asm.poolInterfaceMethod(CharSink.class, &quot;put&quot;, &quot;(C)Lio/questdb/std/str/CharSink;&quot;);</span>

<span class="fc" id="L1299">        int charAtIndex = asm.poolInterfaceMethod(charSequenceClassIndex, &quot;charAt&quot;, &quot;(I)C&quot;);</span>

<span class="fc" id="L1301">        int parseNameIndex = asm.poolUtf8(&quot;parse&quot;);</span>
<span class="fc" id="L1302">        int parseSigIndex = asm.poolUtf8(&quot;(Ljava/lang/CharSequence;IILio/questdb/std/datetime/DateLocale;)J&quot;);</span>
<span class="fc" id="L1303">        int formatNameIndex = asm.poolUtf8(&quot;format&quot;);</span>
<span class="fc" id="L1304">        int formatSigIndex = asm.poolUtf8(&quot;(JLio/questdb/std/datetime/DateLocale;Ljava/lang/CharSequence;Lio/questdb/std/str/CharSink;)V&quot;);</span>

        // pool only delimiters over 1 char in length
        // when delimiter is 1 char we would use shorter code path
        // that doesn't require constant
<span class="fc" id="L1309">        delimiterIndexes.clear();</span>
<span class="fc bfc" id="L1310" title="All 2 branches covered.">        for (int i = 0, n = delimiters.size(); i &lt; n; i++) {</span>
<span class="fc" id="L1311">            String delimiter = delimiters.getQuick(i);</span>
<span class="fc bfc" id="L1312" title="All 2 branches covered.">            if (delimiter.length() &gt; 1) {</span>
<span class="fc" id="L1313">                delimiterIndexes.add(asm.poolStringConst(asm.poolUtf8(delimiter)));</span>
            } else {
                // keep indexes in both lists the same
<span class="fc" id="L1316">                delimiterIndexes.add(-1);</span>
            }
        }

<span class="fc" id="L1320">        asm.finishPool();</span>

<span class="fc" id="L1322">        asm.defineClass(thisClassIndex, superclassIndex);</span>
<span class="fc" id="L1323">        asm.interfaceCount(0);</span>
<span class="fc" id="L1324">        asm.fieldCount(0);</span>
<span class="fc" id="L1325">        asm.methodCount(3);</span>
<span class="fc" id="L1326">        asm.defineDefaultConstructor(superIndex);</span>

<span class="fc" id="L1328">        assembleParseMethod(</span>
                ops,
                delimiters,
                thisClassIndex,
                stackMapTableIndex,
                dateLocaleClassIndex,
                charSequenceClassIndex,
                minLongIndex,
                minMillisIndex,
                matchWeekdayIndex,
                matchMonthIndex,
                matchZoneIndex,
                matchAMPMIndex,
                matchEraIndex,
                parseIntSafelyIndex,
                parseInt000Greedy,
                decodeLenIndex,
                decodeIntIndex,
                assertRemainingIndex,
                assertNoTailIndex,
                parseIntIndex,
                assertStringIndex,
                assertCharIndex,
                computeMillisIndex,
                adjustYearIndex,
                adjustYearMilleniumIndex,
                parseYearGreedyIndex,
                parseOffsetIndex,
                parseNameIndex,
                parseSigIndex,
                delimiterIndexes,
                charAtIndex
        );

<span class="fc" id="L1362">        assembleFormatMethod(</span>
                ops,
                delimiters,
                getWeekdayIndex,
                getShortWeekdayIndex,
                getMonthIndex,
                getShortMonthIndex,
                appendEraIndex,
                appendAmPmIndex,
                appendHour12Index,
                appendHour12PaddedIndex,
                appendHour121Index,
                appendHour121PaddedIndex,
                getYearIndex,
                isLeapYearIndex,
                getMonthOfYearIndex,
                getDayOfMonthIndex,
                getHourOfDayIndex,
                getMinuteOfHourIndex,
                getSecondOfMinuteIndex,
                getMillisOfSecondIndex,
                getDayOfWeekIndex,
                getDayOfYearIndex,
                getWeekOfYearIndex,
                getWeekOfMonthIndex,
                appendYear000Index,
                append00Index,
                append0Index,
                sinkPutIntIndex,
                sinkPutStrIndex,
                sinkPutChrIndex,
                formatNameIndex,
                formatSigIndex
        );

        // class attribute count
<span class="fc" id="L1398">        asm.putShort(0);</span>

<span class="fc" id="L1400">        return asm.newInstance();</span>
    }

    private int computeFormatAttributes(IntList ops) {
<span class="fc" id="L1404">        int attributes = 0;</span>
<span class="fc bfc" id="L1405" title="All 2 branches covered.">        for (int i = 0, n = ops.size(); i &lt; n; i++) {</span>
<span class="fc bfc" id="L1406" title="All 12 branches covered.">            switch (ops.getQuick(i)) {</span>
                // AM/PM
                case DateFormatCompiler.OP_AM_PM:
                    // HOUR
                case DateFormatCompiler.OP_HOUR_12_ONE_DIGIT:
                case DateFormatCompiler.OP_HOUR_12_GREEDY:
                case DateFormatCompiler.OP_HOUR_12_TWO_DIGITS:
                case DateFormatCompiler.OP_HOUR_12_ONE_DIGIT_ONE_BASED:
                case DateFormatCompiler.OP_HOUR_12_GREEDY_ONE_BASED:
                case DateFormatCompiler.OP_HOUR_12_TWO_DIGITS_ONE_BASED:
                case DateFormatCompiler.OP_HOUR_24_ONE_DIGIT:
                case DateFormatCompiler.OP_HOUR_24_GREEDY:
                case DateFormatCompiler.OP_HOUR_24_TWO_DIGITS:
                case DateFormatCompiler.OP_HOUR_24_ONE_DIGIT_ONE_BASED:
                case DateFormatCompiler.OP_HOUR_24_GREEDY_ONE_BASED:
                case DateFormatCompiler.OP_HOUR_24_TWO_DIGITS_ONE_BASED:
<span class="fc" id="L1422">                    attributes |= (1 &lt;&lt; FA_HOUR);</span>
<span class="fc" id="L1423">                    break;</span>
                // MILLIS
                case DateFormatCompiler.OP_MILLIS_ONE_DIGIT:
                case DateFormatCompiler.OP_MILLIS_GREEDY:
                case DateFormatCompiler.OP_MILLIS_THREE_DIGITS:
<span class="fc" id="L1428">                    attributes |= (1 &lt;&lt; FA_SECOND_MILLIS);</span>
<span class="fc" id="L1429">                    break;</span>
                // SECOND
                case DateFormatCompiler.OP_SECOND_ONE_DIGIT:
                case DateFormatCompiler.OP_SECOND_GREEDY:
                case DateFormatCompiler.OP_SECOND_TWO_DIGITS:
<span class="fc" id="L1434">                    attributes |= (1 &lt;&lt; FA_SECOND);</span>
<span class="fc" id="L1435">                    break;</span>
                // MINUTE
                case DateFormatCompiler.OP_MINUTE_ONE_DIGIT:
                case DateFormatCompiler.OP_MINUTE_GREEDY:
                case DateFormatCompiler.OP_MINUTE_TWO_DIGITS:
<span class="fc" id="L1440">                    attributes |= (1 &lt;&lt; FA_MINUTE);</span>
<span class="fc" id="L1441">                    break;</span>

                // DAY OF MONTH
                case DateFormatCompiler.OP_DAY_ONE_DIGIT:
                case DateFormatCompiler.OP_DAY_GREEDY:
                case DateFormatCompiler.OP_DAY_TWO_DIGITS:
<span class="fc" id="L1447">                    attributes |= (1 &lt;&lt; FA_DAY);</span>
<span class="fc" id="L1448">                    attributes |= (1 &lt;&lt; FA_MONTH);</span>
<span class="fc" id="L1449">                    attributes |= (1 &lt;&lt; FA_YEAR);</span>
<span class="fc" id="L1450">                    attributes |= (1 &lt;&lt; FA_LEAP);</span>
<span class="fc" id="L1451">                    break;</span>
                // DAY OF WEEK
                case DateFormatCompiler.OP_DAY_NAME_LONG:
                case DateFormatCompiler.OP_DAY_NAME_SHORT:
                case DateFormatCompiler.OP_DAY_OF_WEEK:
<span class="fc" id="L1456">                    attributes |= (1 &lt;&lt; FA_DAY_OF_WEEK);</span>
<span class="fc" id="L1457">                    break;</span>
                case DateFormatCompiler.OP_DAY_OF_YEAR:
<span class="fc" id="L1459">                    attributes |= (1 &lt;&lt; FA_DAY_OF_YEAR);</span>
<span class="fc" id="L1460">                    break;</span>
                case DateFormatCompiler.OP_WEEK_OF_MONTH:
<span class="fc" id="L1462">                    attributes |= (1 &lt;&lt; FA_WEEK_OF_MONTH);</span>
<span class="fc" id="L1463">                    break;</span>
                case DateFormatCompiler.OP_WEEK_OF_YEAR:
<span class="fc" id="L1465">                    attributes |= (1 &lt;&lt; FA_WEEK_OF_YEAR);</span>
<span class="fc" id="L1466">                    break;</span>
                // MONTH
                case DateFormatCompiler.OP_MONTH_ONE_DIGIT:
                case DateFormatCompiler.OP_MONTH_GREEDY:
                case DateFormatCompiler.OP_MONTH_TWO_DIGITS:
                case DateFormatCompiler.OP_MONTH_SHORT_NAME:
                case DateFormatCompiler.OP_MONTH_LONG_NAME:
<span class="fc" id="L1473">                    attributes |= (1 &lt;&lt; FA_MONTH);</span>
<span class="fc" id="L1474">                    attributes |= (1 &lt;&lt; FA_YEAR);</span>
<span class="fc" id="L1475">                    attributes |= (1 &lt;&lt; FA_LEAP);</span>
<span class="fc" id="L1476">                    break;</span>
                // YEAR
                case DateFormatCompiler.OP_YEAR_ONE_DIGIT:
                case DateFormatCompiler.OP_YEAR_GREEDY:
                case DateFormatCompiler.OP_YEAR_TWO_DIGITS:
                case DateFormatCompiler.OP_YEAR_THREE_DIGITS:
                case DateFormatCompiler.OP_YEAR_FOUR_DIGITS:
                    // ERA
                case DateFormatCompiler.OP_ERA:
<span class="fc" id="L1485">                    attributes |= (1 &lt;&lt; FA_YEAR);</span>
<span class="fc" id="L1486">                    break;</span>
                default:
                    break;
            }
        }
<span class="fc" id="L1491">        return attributes;</span>
    }

    /*
     * For each operation code in given operation list determine which stack slots can be left uninitialized. Set bits
     * in the result integer will represent these stack slots. Bits positions are values of LOCAL_ constants.
     */
    private int computeParseMethodStack(IntList ops) {
<span class="fc" id="L1499">        int result = 0;</span>
<span class="fc bfc" id="L1500" title="All 2 branches covered.">        for (int i = 0, n = ops.size(); i &lt; n; i++) {</span>
<span class="fc bfc" id="L1501" title="All 17 branches covered.">            switch (ops.getQuick(i)) {</span>
                case OP_AM_PM:
                case OP_DAY_NAME_LONG:
                case OP_DAY_NAME_SHORT:
                case OP_TIME_ZONE_SHORT:
                case OP_TIME_ZONE_GMT_BASED:
                case OP_TIME_ZONE_ISO_8601_1:
                case OP_TIME_ZONE_ISO_8601_2:
                case OP_TIME_ZONE_ISO_8601_3:
                case OP_TIME_ZONE_LONG:
                case OP_TIME_ZONE_RFC_822:
<span class="fc" id="L1512">                    result |= (1 &lt;&lt; LOCAL_TEMP_LONG);</span>
<span class="fc" id="L1513">                    break;</span>
                case OP_MILLIS_GREEDY:
<span class="fc" id="L1515">                    result |= (1 &lt;&lt; LOCAL_TEMP_LONG);</span>
                    // fall through
                case OP_MILLIS_ONE_DIGIT:
                case OP_MILLIS_THREE_DIGITS:
<span class="fc" id="L1519">                    result |= (1 &lt;&lt; LOCAL_MILLIS);</span>
<span class="fc" id="L1520">                    break;</span>
                case OP_SECOND_GREEDY:
<span class="fc" id="L1522">                    result |= (1 &lt;&lt; LOCAL_TEMP_LONG);</span>
                    // fall through
                case OP_SECOND_ONE_DIGIT:
                case OP_SECOND_TWO_DIGITS:
<span class="fc" id="L1526">                    result |= (1 &lt;&lt; LOCAL_SECOND);</span>
<span class="fc" id="L1527">                    break;</span>
                case OP_MINUTE_GREEDY:
<span class="fc" id="L1529">                    result |= (1 &lt;&lt; LOCAL_TEMP_LONG);</span>
                case OP_MINUTE_ONE_DIGIT:
                case OP_MINUTE_TWO_DIGITS:
<span class="fc" id="L1532">                    result |= (1 &lt;&lt; LOCAL_MINUTE);</span>
<span class="fc" id="L1533">                    break;</span>
                // HOUR (0-11)
                case OP_HOUR_12_GREEDY:
                case OP_HOUR_12_GREEDY_ONE_BASED:
                case OP_HOUR_24_GREEDY:
                case OP_HOUR_24_GREEDY_ONE_BASED:
<span class="fc" id="L1539">                    result |= (1 &lt;&lt; LOCAL_TEMP_LONG);</span>
                case OP_HOUR_12_ONE_DIGIT:
                case OP_HOUR_12_TWO_DIGITS:
                case OP_HOUR_12_ONE_DIGIT_ONE_BASED:
                case OP_HOUR_12_TWO_DIGITS_ONE_BASED:
                case OP_HOUR_24_ONE_DIGIT:
                case OP_HOUR_24_TWO_DIGITS:
                case OP_HOUR_24_ONE_DIGIT_ONE_BASED:
                case OP_HOUR_24_TWO_DIGITS_ONE_BASED:
<span class="fc" id="L1548">                    result |= (1 &lt;&lt; LOCAL_HOUR);</span>
<span class="fc" id="L1549">                    break;</span>
                // DAY
                case OP_DAY_GREEDY:
<span class="fc" id="L1552">                    result |= (1 &lt;&lt; LOCAL_TEMP_LONG);</span>
                case OP_DAY_ONE_DIGIT:
                case OP_DAY_TWO_DIGITS:
<span class="fc" id="L1555">                    result |= (1 &lt;&lt; LOCAL_DAY);</span>
<span class="fc" id="L1556">                    break;</span>
                case OP_MONTH_GREEDY:
                case OP_MONTH_SHORT_NAME:
                case OP_MONTH_LONG_NAME:
<span class="fc" id="L1560">                    result |= (1 &lt;&lt; LOCAL_TEMP_LONG);</span>
                case OP_MONTH_ONE_DIGIT:
                case OP_MONTH_TWO_DIGITS:
<span class="fc" id="L1563">                    result |= (1 &lt;&lt; LOCAL_MONTH);</span>
<span class="fc" id="L1564">                    break;</span>
                case OP_YEAR_GREEDY:
<span class="fc" id="L1566">                    result |= (1 &lt;&lt; LOCAL_TEMP_LONG);</span>
                case OP_YEAR_ONE_DIGIT:
                case OP_YEAR_TWO_DIGITS:
                case OP_YEAR_THREE_DIGITS:
                case OP_YEAR_FOUR_DIGITS:
<span class="fc" id="L1571">                    result |= (1 &lt;&lt; LOCAL_YEAR);</span>
<span class="fc" id="L1572">                    break;</span>
                case OP_ERA:
<span class="fc" id="L1574">                    result |= (1 &lt;&lt; LOCAL_ERA);</span>
<span class="fc" id="L1575">                    break;</span>
                default:
                    break;

            }
        }
<span class="fc" id="L1581">        return result;</span>
    }

    private void decodeInt(int decodeIntIndex) {
<span class="fc" id="L1585">        asm.lload(LOCAL_TEMP_LONG);</span>
<span class="fc" id="L1586">        asm.invokeStatic(decodeIntIndex);</span>
<span class="fc" id="L1587">    }</span>

    private boolean invokeConvertMillis(int formatAttributes, int bit, int funcIndex, int stackIndex) {
<span class="fc bfc" id="L1590" title="All 2 branches covered.">        if ((formatAttributes &amp; (1 &lt;&lt; bit)) != 0) {</span>
<span class="fc" id="L1591">            asm.lload(FA_LOCAL_DATETIME);</span>
<span class="fc" id="L1592">            asm.invokeStatic(funcIndex);</span>
<span class="fc" id="L1593">            asm.istore(stackIndex);</span>
<span class="fc" id="L1594">            return true;</span>
        }
<span class="fc" id="L1596">        return false;</span>
    }

    private void invokeMatch(int matchIndex) {
<span class="fc" id="L1600">        asm.aload(P_LOCALE);</span>
<span class="fc" id="L1601">        asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L1602">        asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1603">        asm.iload(P_HI);</span>
<span class="fc" id="L1604">        asm.invokeVirtual(matchIndex);</span>
<span class="fc" id="L1605">        asm.lstore(LOCAL_TEMP_LONG);</span>
<span class="fc" id="L1606">    }</span>

    private void invokeParseIntSafelyAndStore(
            int parseIntSafelyIndex,
            int decodeLenIndex,
            int decodeIntIndex,
            int target) {
<span class="fc" id="L1613">        asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L1614">        asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1615">        asm.iload(P_HI);</span>
<span class="fc" id="L1616">        asm.invokeStatic(parseIntSafelyIndex);</span>
<span class="fc" id="L1617">        asm.lstore(LOCAL_TEMP_LONG);</span>
<span class="fc" id="L1618">        decodeInt(decodeIntIndex);</span>
<span class="fc" id="L1619">        asm.istore(target);</span>
<span class="fc" id="L1620">        addTempToPos(decodeLenIndex);</span>
<span class="fc" id="L1621">    }</span>

    private int makeGreedy(int oldOp) {
<span class="fc bfc" id="L1624" title="All 11 branches covered.">        switch (oldOp) {</span>
            case OP_YEAR_ONE_DIGIT:
<span class="fc" id="L1626">                return OP_YEAR_GREEDY;</span>
            case OP_MONTH_ONE_DIGIT:
<span class="fc" id="L1628">                return OP_MONTH_GREEDY;</span>
            case OP_DAY_ONE_DIGIT:
<span class="fc" id="L1630">                return OP_DAY_GREEDY;</span>
            case OP_HOUR_24_ONE_DIGIT:
<span class="fc" id="L1632">                return OP_HOUR_24_GREEDY;</span>
            case OP_HOUR_24_ONE_DIGIT_ONE_BASED:
<span class="fc" id="L1634">                return OP_HOUR_24_GREEDY_ONE_BASED;</span>
            case OP_HOUR_12_ONE_DIGIT:
<span class="fc" id="L1636">                return OP_HOUR_12_GREEDY;</span>
            case OP_HOUR_12_ONE_DIGIT_ONE_BASED:
<span class="fc" id="L1638">                return OP_HOUR_12_GREEDY_ONE_BASED;</span>
            case OP_MINUTE_ONE_DIGIT:
<span class="fc" id="L1640">                return OP_MINUTE_GREEDY;</span>
            case OP_SECOND_ONE_DIGIT:
<span class="fc" id="L1642">                return OP_SECOND_GREEDY;</span>
            case OP_MILLIS_ONE_DIGIT:
<span class="fc" id="L1644">                return OP_MILLIS_GREEDY;</span>
            default:
<span class="fc" id="L1646">                return oldOp;</span>
        }
    }

    private void makeLastOpGreedy(IntList compiled) {
<span class="fc" id="L1651">        int lastOpIndex = compiled.size() - 1;</span>
<span class="fc bfc" id="L1652" title="All 2 branches covered.">        if (lastOpIndex &gt; -1) {</span>
<span class="fc" id="L1653">            int oldOp = compiled.getQuick(lastOpIndex);</span>
<span class="fc bfc" id="L1654" title="All 2 branches covered.">            if (oldOp &gt; 0) {</span>
<span class="fc" id="L1655">                int newOp = makeGreedy(oldOp);</span>
<span class="fc bfc" id="L1656" title="All 2 branches covered.">                if (newOp != oldOp) {</span>
<span class="fc" id="L1657">                    compiled.setQuick(lastOpIndex, newOp);</span>
                }
            }
        }
<span class="fc" id="L1661">    }</span>

    private void parseDigits(int assertRemainingIndex, int parseIntIndex, int digitCount, int target) {
<span class="fc" id="L1664">        asm.iload(LOCAL_POS);</span>
<span class="fc bfc" id="L1665" title="All 2 branches covered.">        if (digitCount &gt; 1) {</span>
<span class="fc" id="L1666">            asm.iconst(digitCount - 1);</span>
<span class="fc" id="L1667">            asm.iadd();</span>
        }
<span class="fc" id="L1669">        asm.iload(P_HI);</span>
<span class="fc" id="L1670">        asm.invokeStatic(assertRemainingIndex);</span>

<span class="fc" id="L1672">        asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L1673">        asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1674">        asm.iinc(LOCAL_POS, digitCount);</span>
<span class="fc" id="L1675">        asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1676">        asm.invokeStatic(parseIntIndex);</span>
<span class="fc" id="L1677">        asm.istore(target);</span>
<span class="fc" id="L1678">    }</span>

    private void parseDigitsSub1(int assertRemainingIndex, int parseIntIndex, int digitCount) {
<span class="fc" id="L1681">        asm.iload(LOCAL_POS);</span>
<span class="fc bfc" id="L1682" title="All 2 branches covered.">        if (digitCount &gt; 1) {</span>
<span class="fc" id="L1683">            asm.iconst(digitCount - 1);</span>
<span class="fc" id="L1684">            asm.iadd();</span>
        }
<span class="fc" id="L1686">        asm.iload(P_HI);</span>
<span class="fc" id="L1687">        asm.invokeStatic(assertRemainingIndex);</span>

<span class="fc" id="L1689">        asm.aload(P_INPUT_STR);</span>
<span class="fc" id="L1690">        asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1691">        asm.iinc(LOCAL_POS, digitCount);</span>
<span class="fc" id="L1692">        asm.iload(LOCAL_POS);</span>
<span class="fc" id="L1693">        asm.invokeStatic(parseIntIndex);</span>
<span class="fc" id="L1694">        asm.iconst(1);</span>
<span class="fc" id="L1695">        asm.isub();</span>
<span class="fc" id="L1696">        asm.istore(DateFormatCompiler.LOCAL_HOUR);</span>
<span class="fc" id="L1697">    }</span>

    private void parseTwoDigits(int assertRemainingIndex, int parseIntIndex, int target) {
<span class="fc" id="L1700">        parseDigits(assertRemainingIndex, parseIntIndex, 2, target);</span>
<span class="fc" id="L1701">    }</span>

    private void setHourType(int stackState) {
<span class="fc" id="L1704">        asm.iload(LOCAL_HOUR_TYPE);</span>
<span class="fc" id="L1705">        asm.iconst(DateFormatUtils.HOUR_24);</span>
<span class="fc" id="L1706">        int branch = asm.if_icmpne();</span>
<span class="fc" id="L1707">        asm.iconst(DateFormatUtils.HOUR_AM);</span>
<span class="fc" id="L1708">        asm.istore(LOCAL_HOUR_TYPE);</span>
<span class="fc" id="L1709">        int p = asm.position();</span>
<span class="fc" id="L1710">        frameOffsets.add(Numbers.encodeLowHighInts(stackState, p));</span>
<span class="fc" id="L1711">        asm.setJmp(branch, p);</span>
<span class="fc" id="L1712">    }</span>

    static {
<span class="fc" id="L1715">        opMap = new CharSequenceIntHashMap();</span>
<span class="fc" id="L1716">        opList = new ObjList&lt;&gt;();</span>

<span class="fc" id="L1718">        addOp(&quot;G&quot;, OP_ERA);</span>
<span class="fc" id="L1719">        addOp(&quot;y&quot;, OP_YEAR_ONE_DIGIT);</span>
<span class="fc" id="L1720">        addOp(&quot;yy&quot;, OP_YEAR_TWO_DIGITS);</span>
<span class="fc" id="L1721">        addOp(&quot;yyy&quot;, OP_YEAR_THREE_DIGITS);</span>
<span class="fc" id="L1722">        addOp(&quot;yyyy&quot;, OP_YEAR_FOUR_DIGITS);</span>
<span class="fc" id="L1723">        addOp(&quot;M&quot;, OP_MONTH_ONE_DIGIT);</span>
<span class="fc" id="L1724">        addOp(&quot;MM&quot;, OP_MONTH_TWO_DIGITS);</span>
<span class="fc" id="L1725">        addOp(&quot;MMM&quot;, OP_MONTH_SHORT_NAME);</span>
<span class="fc" id="L1726">        addOp(&quot;MMMM&quot;, OP_MONTH_LONG_NAME);</span>
<span class="fc" id="L1727">        addOp(&quot;d&quot;, OP_DAY_ONE_DIGIT);</span>
<span class="fc" id="L1728">        addOp(&quot;dd&quot;, OP_DAY_TWO_DIGITS);</span>
<span class="fc" id="L1729">        addOp(&quot;D&quot;, OP_DAY_OF_YEAR);</span>
<span class="fc" id="L1730">        addOp(&quot;w&quot;, OP_WEEK_OF_YEAR);</span>
<span class="fc" id="L1731">        addOp(&quot;W&quot;, OP_WEEK_OF_MONTH);</span>
<span class="fc" id="L1732">        addOp(&quot;E&quot;, OP_DAY_NAME_SHORT);</span>
<span class="fc" id="L1733">        addOp(&quot;EE&quot;, OP_DAY_NAME_LONG);</span>
<span class="fc" id="L1734">        addOp(&quot;u&quot;, OP_DAY_OF_WEEK);</span>
<span class="fc" id="L1735">        addOp(&quot;a&quot;, OP_AM_PM);</span>
<span class="fc" id="L1736">        addOp(&quot;H&quot;, OP_HOUR_24_ONE_DIGIT);</span>
<span class="fc" id="L1737">        addOp(&quot;HH&quot;, OP_HOUR_24_TWO_DIGITS);</span>
<span class="fc" id="L1738">        addOp(&quot;k&quot;, OP_HOUR_24_ONE_DIGIT_ONE_BASED);</span>
<span class="fc" id="L1739">        addOp(&quot;kk&quot;, OP_HOUR_24_TWO_DIGITS_ONE_BASED);</span>
<span class="fc" id="L1740">        addOp(&quot;K&quot;, OP_HOUR_12_ONE_DIGIT);</span>
<span class="fc" id="L1741">        addOp(&quot;KK&quot;, OP_HOUR_12_TWO_DIGITS);</span>
<span class="fc" id="L1742">        addOp(&quot;h&quot;, OP_HOUR_12_ONE_DIGIT_ONE_BASED);</span>
<span class="fc" id="L1743">        addOp(&quot;hh&quot;, OP_HOUR_12_TWO_DIGITS_ONE_BASED);</span>
<span class="fc" id="L1744">        addOp(&quot;m&quot;, OP_MINUTE_ONE_DIGIT);</span>
<span class="fc" id="L1745">        addOp(&quot;mm&quot;, OP_MINUTE_TWO_DIGITS);</span>
<span class="fc" id="L1746">        addOp(&quot;s&quot;, OP_SECOND_ONE_DIGIT);</span>
<span class="fc" id="L1747">        addOp(&quot;ss&quot;, OP_SECOND_TWO_DIGITS);</span>
<span class="fc" id="L1748">        addOp(&quot;S&quot;, OP_MILLIS_ONE_DIGIT);</span>
<span class="fc" id="L1749">        addOp(&quot;SSS&quot;, OP_MILLIS_THREE_DIGITS);</span>
<span class="fc" id="L1750">        addOp(&quot;z&quot;, OP_TIME_ZONE_SHORT);</span>
<span class="fc" id="L1751">        addOp(&quot;zz&quot;, OP_TIME_ZONE_GMT_BASED);</span>
<span class="fc" id="L1752">        addOp(&quot;zzz&quot;, OP_TIME_ZONE_LONG);</span>
<span class="fc" id="L1753">        addOp(&quot;Z&quot;, OP_TIME_ZONE_RFC_822);</span>
<span class="fc" id="L1754">        addOp(&quot;x&quot;, OP_TIME_ZONE_ISO_8601_1);</span>
<span class="fc" id="L1755">        addOp(&quot;xx&quot;, OP_TIME_ZONE_ISO_8601_2);</span>
<span class="fc" id="L1756">        addOp(&quot;xxx&quot;, OP_TIME_ZONE_ISO_8601_3);</span>
<span class="fc" id="L1757">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>