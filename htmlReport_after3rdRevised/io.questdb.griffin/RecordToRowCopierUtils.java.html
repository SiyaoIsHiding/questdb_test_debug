<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RecordToRowCopierUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">All in questdb Coverage Results, io.questdb in questdb Coverage Results</a> &gt; <a href="index.source.html" class="el_package">io.questdb.griffin</a> &gt; <span class="el_source">RecordToRowCopierUtils.java</span></div><h1>RecordToRowCopierUtils.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 *     ___                  _   ____  ____
 *    / _ \ _   _  ___  ___| |_|  _ \| __ )
 *   | | | | | | |/ _ \/ __| __| | | |  _ \
 *   | |_| | |_| |  __/\__ \ |_| |_| | |_) |
 *    \__\_\\__,_|\___||___/\__|____/|____/
 *
 *  Copyright (c) 2014-2019 Appsicle
 *  Copyright (c) 2019-2022 QuestDB
 *
 *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 ******************************************************************************/

package io.questdb.griffin;

import io.questdb.cairo.ColumnFilter;
import io.questdb.cairo.ColumnType;
import io.questdb.cairo.ColumnTypes;
import io.questdb.cairo.TableWriter;
import io.questdb.cairo.sql.Record;
import io.questdb.cairo.sql.RecordMetadata;
import io.questdb.std.BytecodeAssembler;
import io.questdb.std.Misc;
import io.questdb.std.str.StringSink;

<span class="fc" id="L37">public class RecordToRowCopierUtils {</span>
    private RecordToRowCopierUtils() {
    }

    // Creates data type converter.
    // INT and LONG NaN values are cast to their representation rather than Double or Float NaN.
    public static RecordToRowCopier generateCopier(
            BytecodeAssembler asm,
            ColumnTypes from,
            RecordMetadata to,
            ColumnFilter toColumnFilter
    ) {
<span class="fc" id="L49">        int timestampIndex = to.getTimestampIndex();</span>
<span class="fc" id="L50">        asm.init(RecordToRowCopier.class);</span>
<span class="fc" id="L51">        asm.setupPool();</span>
<span class="fc" id="L52">        int thisClassIndex = asm.poolClass(asm.poolUtf8(&quot;io/questdb/griffin/rowcopier&quot;));</span>
<span class="fc" id="L53">        int interfaceClassIndex = asm.poolClass(RecordToRowCopier.class);</span>

<span class="fc" id="L55">        int rGetInt = asm.poolInterfaceMethod(Record.class, &quot;getInt&quot;, &quot;(I)I&quot;);</span>
<span class="fc" id="L56">        int rGetGeoInt = asm.poolInterfaceMethod(Record.class, &quot;getGeoInt&quot;, &quot;(I)I&quot;);</span>
<span class="fc" id="L57">        int rGetLong = asm.poolInterfaceMethod(Record.class, &quot;getLong&quot;, &quot;(I)J&quot;);</span>
<span class="fc" id="L58">        int rGetGeoLong = asm.poolInterfaceMethod(Record.class, &quot;getGeoLong&quot;, &quot;(I)J&quot;);</span>
<span class="fc" id="L59">        int rGetLong256 = asm.poolInterfaceMethod(Record.class, &quot;getLong256A&quot;, &quot;(I)Lio/questdb/std/Long256;&quot;);</span>
<span class="fc" id="L60">        int rGetLong128Lo = asm.poolInterfaceMethod(Record.class, &quot;getLong128Lo&quot;, &quot;(I)J&quot;);</span>
<span class="fc" id="L61">        int rGetLong128Hi = asm.poolInterfaceMethod(Record.class, &quot;getLong128Hi&quot;, &quot;(I)J&quot;);</span>

<span class="fc" id="L63">        int rGetDate = asm.poolInterfaceMethod(Record.class, &quot;getDate&quot;, &quot;(I)J&quot;);</span>
<span class="fc" id="L64">        int rGetTimestamp = asm.poolInterfaceMethod(Record.class, &quot;getTimestamp&quot;, &quot;(I)J&quot;);</span>
        //
<span class="fc" id="L66">        int rGetByte = asm.poolInterfaceMethod(Record.class, &quot;getByte&quot;, &quot;(I)B&quot;);</span>
<span class="fc" id="L67">        int rGetGeoByte = asm.poolInterfaceMethod(Record.class, &quot;getGeoByte&quot;, &quot;(I)B&quot;);</span>
<span class="fc" id="L68">        int rGetShort = asm.poolInterfaceMethod(Record.class, &quot;getShort&quot;, &quot;(I)S&quot;);</span>
<span class="fc" id="L69">        int rGetGeoShort = asm.poolInterfaceMethod(Record.class, &quot;getGeoShort&quot;, &quot;(I)S&quot;);</span>
<span class="fc" id="L70">        int rGetChar = asm.poolInterfaceMethod(Record.class, &quot;getChar&quot;, &quot;(I)C&quot;);</span>
<span class="fc" id="L71">        int rGetBool = asm.poolInterfaceMethod(Record.class, &quot;getBool&quot;, &quot;(I)Z&quot;);</span>
<span class="fc" id="L72">        int rGetFloat = asm.poolInterfaceMethod(Record.class, &quot;getFloat&quot;, &quot;(I)F&quot;);</span>
<span class="fc" id="L73">        int rGetDouble = asm.poolInterfaceMethod(Record.class, &quot;getDouble&quot;, &quot;(I)D&quot;);</span>
<span class="fc" id="L74">        int rGetSym = asm.poolInterfaceMethod(Record.class, &quot;getSym&quot;, &quot;(I)Ljava/lang/CharSequence;&quot;);</span>
<span class="fc" id="L75">        int rGetStr = asm.poolInterfaceMethod(Record.class, &quot;getStr&quot;, &quot;(I)Ljava/lang/CharSequence;&quot;);</span>
<span class="fc" id="L76">        int rGetBin = asm.poolInterfaceMethod(Record.class, &quot;getBin&quot;, &quot;(I)Lio/questdb/std/BinarySequence;&quot;);</span>
        //
<span class="fc" id="L78">        int wPutInt = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putInt&quot;, &quot;(II)V&quot;);</span>
<span class="fc" id="L79">        int wPutLong = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putLong&quot;, &quot;(IJ)V&quot;);</span>
<span class="fc" id="L80">        int wPutLong256 = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putLong256&quot;, &quot;(ILio/questdb/std/Long256;)V&quot;);</span>
<span class="fc" id="L81">        int wPutLong128 = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putLong128&quot;, &quot;(IJJ)V&quot;);</span>
<span class="fc" id="L82">        int wPutUuidStr = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putUuid&quot;, &quot;(ILjava/lang/CharSequence;)V&quot;);</span>
<span class="fc" id="L83">        int wPutDate = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putDate&quot;, &quot;(IJ)V&quot;);</span>
<span class="fc" id="L84">        int wPutTimestamp = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putTimestamp&quot;, &quot;(IJ)V&quot;);</span>
        //
<span class="fc" id="L86">        int wPutByte = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putByte&quot;, &quot;(IB)V&quot;);</span>
<span class="fc" id="L87">        int wPutShort = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putShort&quot;, &quot;(IS)V&quot;);</span>
<span class="fc" id="L88">        int wPutBool = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putBool&quot;, &quot;(IZ)V&quot;);</span>
<span class="fc" id="L89">        int wPutFloat = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putFloat&quot;, &quot;(IF)V&quot;);</span>
<span class="fc" id="L90">        int wPutDouble = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putDouble&quot;, &quot;(ID)V&quot;);</span>
<span class="fc" id="L91">        int wPutSym = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putSym&quot;, &quot;(ILjava/lang/CharSequence;)V&quot;);</span>
<span class="fc" id="L92">        int wPutSymChar = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putSym&quot;, &quot;(IC)V&quot;);</span>
<span class="fc" id="L93">        int wPutStr = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putStr&quot;, &quot;(ILjava/lang/CharSequence;)V&quot;);</span>
<span class="fc" id="L94">        int wPutGeoStr = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putGeoStr&quot;, &quot;(ILjava/lang/CharSequence;)V&quot;);</span>
<span class="fc" id="L95">        int implicitCastCharAsByte = asm.poolMethod(SqlUtil.class, &quot;implicitCastCharAsByte&quot;, &quot;(CI)B&quot;);</span>
<span class="fc" id="L96">        int implicitCastCharAsGeoHash = asm.poolMethod(SqlUtil.class, &quot;implicitCastCharAsGeoHash&quot;, &quot;(CI)B&quot;);</span>
<span class="fc" id="L97">        int implicitCastStrAsFloat = asm.poolMethod(SqlUtil.class, &quot;implicitCastStrAsFloat&quot;, &quot;(Ljava/lang/CharSequence;)F&quot;);</span>
<span class="fc" id="L98">        int implicitCastStrAsDouble = asm.poolMethod(SqlUtil.class, &quot;implicitCastStrAsDouble&quot;, &quot;(Ljava/lang/CharSequence;)D&quot;);</span>
<span class="fc" id="L99">        int implicitCastStrAsByte = asm.poolMethod(SqlUtil.class, &quot;implicitCastStrAsByte&quot;, &quot;(Ljava/lang/CharSequence;)B&quot;);</span>
<span class="fc" id="L100">        int implicitCastStrAsShort = asm.poolMethod(SqlUtil.class, &quot;implicitCastStrAsShort&quot;, &quot;(Ljava/lang/CharSequence;)S&quot;);</span>
<span class="fc" id="L101">        int implicitCastStrAsChar = asm.poolMethod(SqlUtil.class, &quot;implicitCastStrAsChar&quot;, &quot;(Ljava/lang/CharSequence;)C&quot;);</span>
<span class="fc" id="L102">        int implicitCastStrAsInt = asm.poolMethod(SqlUtil.class, &quot;implicitCastStrAsInt&quot;, &quot;(Ljava/lang/CharSequence;)I&quot;);</span>
<span class="fc" id="L103">        int implicitCastStrAsLong = asm.poolMethod(SqlUtil.class, &quot;implicitCastStrAsLong&quot;, &quot;(Ljava/lang/CharSequence;)J&quot;);</span>
<span class="fc" id="L104">        int implicitCastStrAsDate = asm.poolMethod(SqlUtil.class, &quot;implicitCastStrAsDate&quot;, &quot;(Ljava/lang/CharSequence;)J&quot;);</span>
<span class="fc" id="L105">        int implicitCastStrAsTimestamp = asm.poolMethod(SqlUtil.class, &quot;implicitCastStrAsTimestamp&quot;, &quot;(Ljava/lang/CharSequence;)J&quot;);</span>
<span class="fc" id="L106">        int implicitCastDateAsTimestamp = asm.poolMethod(SqlUtil.class, &quot;dateToTimestamp&quot;, &quot;(J)J&quot;);</span>
<span class="fc" id="L107">        int implicitCastShortAsByte = asm.poolMethod(SqlUtil.class, &quot;implicitCastShortAsByte&quot;, &quot;(S)B&quot;);</span>
<span class="fc" id="L108">        int implicitCastIntAsByte = asm.poolMethod(SqlUtil.class, &quot;implicitCastIntAsByte&quot;, &quot;(I)B&quot;);</span>
<span class="fc" id="L109">        int implicitCastLongAsByte = asm.poolMethod(SqlUtil.class, &quot;implicitCastLongAsByte&quot;, &quot;(J)B&quot;);</span>
<span class="fc" id="L110">        int implicitCastFloatAsByte = asm.poolMethod(SqlUtil.class, &quot;implicitCastFloatAsByte&quot;, &quot;(F)B&quot;);</span>
<span class="fc" id="L111">        int implicitCastDoubleAsByte = asm.poolMethod(SqlUtil.class, &quot;implicitCastDoubleAsByte&quot;, &quot;(D)B&quot;);</span>

<span class="fc" id="L113">        int implicitCastIntAsShort = asm.poolMethod(SqlUtil.class, &quot;implicitCastIntAsShort&quot;, &quot;(I)S&quot;);</span>
<span class="fc" id="L114">        int implicitCastLongAsShort = asm.poolMethod(SqlUtil.class, &quot;implicitCastLongAsShort&quot;, &quot;(J)S&quot;);</span>
<span class="fc" id="L115">        int implicitCastFloatAsShort = asm.poolMethod(SqlUtil.class, &quot;implicitCastFloatAsShort&quot;, &quot;(F)S&quot;);</span>
<span class="fc" id="L116">        int implicitCastDoubleAsShort = asm.poolMethod(SqlUtil.class, &quot;implicitCastDoubleAsShort&quot;, &quot;(D)S&quot;);</span>

<span class="fc" id="L118">        int implicitCastLongAsInt = asm.poolMethod(SqlUtil.class, &quot;implicitCastLongAsInt&quot;, &quot;(J)I&quot;);</span>
<span class="fc" id="L119">        int implicitCastFloatAsInt = asm.poolMethod(SqlUtil.class, &quot;implicitCastFloatAsInt&quot;, &quot;(F)I&quot;);</span>
<span class="fc" id="L120">        int implicitCastDoubleAsInt = asm.poolMethod(SqlUtil.class, &quot;implicitCastDoubleAsInt&quot;, &quot;(D)I&quot;);</span>

<span class="fc" id="L122">        int implicitCastFloatAsLong = asm.poolMethod(SqlUtil.class, &quot;implicitCastFloatAsLong&quot;, &quot;(F)J&quot;);</span>
<span class="fc" id="L123">        int implicitCastDoubleAsLong = asm.poolMethod(SqlUtil.class, &quot;implicitCastDoubleAsLong&quot;, &quot;(D)J&quot;);</span>
<span class="fc" id="L124">        int implicitCastDoubleAsFloat = asm.poolMethod(SqlUtil.class, &quot;implicitCastDoubleAsFloat&quot;, &quot;(D)F&quot;);</span>
<span class="fc" id="L125">        int wPutStrChar = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putStr&quot;, &quot;(IC)V&quot;);</span>
<span class="fc" id="L126">        int wPutChar = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putChar&quot;, &quot;(IC)V&quot;);</span>
<span class="fc" id="L127">        int wPutBin = asm.poolInterfaceMethod(TableWriter.Row.class, &quot;putBin&quot;, &quot;(ILio/questdb/std/BinarySequence;)V&quot;);</span>
<span class="fc" id="L128">        int implicitCastGeoHashAsGeoHash = asm.poolMethod(SqlUtil.class, &quot;implicitCastGeoHashAsGeoHash&quot;, &quot;(JII)J&quot;);</span>
<span class="fc" id="L129">        int transferUuidToStrCol = asm.poolMethod(RecordToRowCopierUtils.class, &quot;transferUuidToStrCol&quot;, &quot;(Lio/questdb/cairo/TableWriter$Row;IJJ)V&quot;);</span>

        // in case of Geo Hashes column type can overflow short and asm.iconst() will not provide
        // the correct value.
<span class="fc" id="L133">        int n = toColumnFilter.getColumnCount();</span>

        // pool column type constants
<span class="fc" id="L136">        int toColumnType_0 = asm.getPoolCount();</span>
<span class="fc" id="L137">        int fromColumnType_0 = toColumnType_0 + 1;</span>
<span class="fc bfc" id="L138" title="All 2 branches covered.">        for (int i = 0; i &lt; n; i++) {</span>
<span class="fc" id="L139">            asm.poolIntConst(</span>
<span class="fc" id="L140">                    to.getColumnType(</span>
<span class="fc" id="L141">                            toColumnFilter.getColumnIndexFactored(i))</span>
            );
<span class="fc" id="L143">            asm.poolIntConst(from.getColumnType(i));</span>
        }

<span class="fc" id="L146">        int copyNameIndex = asm.poolUtf8(&quot;copy&quot;);</span>
<span class="fc" id="L147">        int copySigIndex = asm.poolUtf8(&quot;(Lio/questdb/cairo/sql/Record;Lio/questdb/cairo/TableWriter$Row;)V&quot;);</span>

<span class="fc" id="L149">        asm.finishPool();</span>
<span class="fc" id="L150">        asm.defineClass(thisClassIndex);</span>
<span class="fc" id="L151">        asm.interfaceCount(1);</span>
<span class="fc" id="L152">        asm.putShort(interfaceClassIndex);</span>
<span class="fc" id="L153">        asm.fieldCount(0);</span>
<span class="fc" id="L154">        asm.methodCount(2);</span>
<span class="fc" id="L155">        asm.defineDefaultConstructor();</span>

<span class="fc" id="L157">        asm.startMethod(copyNameIndex, copySigIndex, 15, 5);</span>

<span class="fc bfc" id="L159" title="All 2 branches covered.">        for (int i = 0; i &lt; n; i++) {</span>

<span class="fc" id="L161">            final int toColumnIndex = toColumnFilter.getColumnIndexFactored(i);</span>
            // do not copy timestamp, it will be copied externally to this helper

<span class="fc bfc" id="L164" title="All 2 branches covered.">            if (toColumnIndex == timestampIndex) {</span>
<span class="fc" id="L165">                continue;</span>
            }

<span class="fc" id="L168">            final int toColumnType = to.getColumnType(toColumnIndex);</span>
<span class="fc" id="L169">            final int fromColumnType = from.getColumnType(i);</span>
<span class="fc" id="L170">            final int toColumnTypeTag = ColumnType.tagOf(toColumnType);</span>
<span class="fc" id="L171">            final int toColumnWriterIndex = to.getWriterIndex(toColumnIndex);</span>

<span class="fc" id="L173">            asm.aload(2);</span>
<span class="fc" id="L174">            asm.iconst(toColumnWriterIndex);</span>
<span class="fc" id="L175">            asm.aload(1);</span>
<span class="fc" id="L176">            asm.iconst(i);</span>

<span class="fc" id="L178">            int fromColumnTypeTag = ColumnType.tagOf(fromColumnType);</span>
<span class="fc bfc" id="L179" title="All 2 branches covered.">            if (fromColumnTypeTag == ColumnType.NULL) {</span>
<span class="fc" id="L180">                fromColumnTypeTag = toColumnTypeTag;</span>
            }
<span class="fc bfc" id="L182" title="All 20 branches covered.">            switch (fromColumnTypeTag) {</span>
                case ColumnType.INT:
<span class="fc" id="L184">                    asm.invokeInterface(rGetInt);</span>
<span class="pc bpc" id="L185" title="1 of 9 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.BYTE:
<span class="fc" id="L187">                            asm.invokeStatic(implicitCastIntAsByte);</span>
<span class="fc" id="L188">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L189">                            break;</span>
                        case ColumnType.SHORT:
<span class="fc" id="L191">                            asm.invokeStatic(implicitCastIntAsShort);</span>
<span class="fc" id="L192">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L193">                            break;</span>
                        case ColumnType.INT:
<span class="fc" id="L195">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L196">                            break;</span>
                        case ColumnType.LONG:
<span class="fc" id="L198">                            asm.i2l();</span>
<span class="fc" id="L199">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L200">                            break;</span>
                        case ColumnType.DATE:
<span class="fc" id="L202">                            asm.i2l();</span>
<span class="fc" id="L203">                            asm.invokeInterface(wPutDate, 3);</span>
<span class="fc" id="L204">                            break;</span>
                        case ColumnType.TIMESTAMP:
<span class="fc" id="L206">                            asm.i2l();</span>
<span class="fc" id="L207">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L208">                            break;</span>
                        case ColumnType.FLOAT:
<span class="fc" id="L210">                            asm.i2f();</span>
<span class="fc" id="L211">                            asm.invokeInterface(wPutFloat, 2);</span>
<span class="fc" id="L212">                            break;</span>
                        case ColumnType.DOUBLE:
<span class="fc" id="L214">                            asm.i2d();</span>
<span class="fc" id="L215">                            asm.invokeInterface(wPutDouble, 3);</span>
<span class="fc" id="L216">                            break;</span>
                        default:
<span class="nc" id="L218">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.LONG:
<span class="fc" id="L223">                    asm.invokeInterface(rGetLong);</span>
<span class="pc bpc" id="L224" title="1 of 9 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.BYTE:
<span class="fc" id="L226">                            asm.invokeStatic(implicitCastLongAsByte);</span>
<span class="fc" id="L227">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L228">                            break;</span>
                        case ColumnType.SHORT:
<span class="fc" id="L230">                            asm.invokeStatic(implicitCastLongAsShort);</span>
<span class="fc" id="L231">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L232">                            break;</span>
                        case ColumnType.INT:
<span class="fc" id="L234">                            asm.invokeStatic(implicitCastLongAsInt);</span>
<span class="fc" id="L235">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L236">                            break;</span>
                        case ColumnType.LONG:
<span class="fc" id="L238">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L239">                            break;</span>
                        case ColumnType.DATE:
<span class="fc" id="L241">                            asm.invokeInterface(wPutDate, 3);</span>
<span class="fc" id="L242">                            break;</span>
                        case ColumnType.TIMESTAMP:
<span class="fc" id="L244">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L245">                            break;</span>
                        case ColumnType.FLOAT:
<span class="fc" id="L247">                            asm.l2f();</span>
<span class="fc" id="L248">                            asm.invokeInterface(wPutFloat, 2);</span>
<span class="fc" id="L249">                            break;</span>
                        case ColumnType.DOUBLE:
<span class="fc" id="L251">                            asm.l2d();</span>
<span class="fc" id="L252">                            asm.invokeInterface(wPutDouble, 3);</span>
<span class="fc" id="L253">                            break;</span>
                        default:
<span class="nc" id="L255">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.DATE:
<span class="fc" id="L260">                    asm.invokeInterface(rGetDate);</span>
<span class="pc bpc" id="L261" title="1 of 9 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.BYTE:
<span class="fc" id="L263">                            asm.invokeStatic(implicitCastLongAsByte);</span>
<span class="fc" id="L264">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L265">                            break;</span>
                        case ColumnType.SHORT:
<span class="fc" id="L267">                            asm.invokeStatic(implicitCastLongAsShort);</span>
<span class="fc" id="L268">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L269">                            break;</span>
                        case ColumnType.INT:
<span class="fc" id="L271">                            asm.invokeStatic(implicitCastLongAsInt);</span>
<span class="fc" id="L272">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L273">                            break;</span>
                        case ColumnType.LONG:
<span class="fc" id="L275">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L276">                            break;</span>
                        case ColumnType.DATE:
<span class="fc" id="L278">                            asm.invokeInterface(wPutDate, 3);</span>
<span class="fc" id="L279">                            break;</span>
                        case ColumnType.TIMESTAMP:
<span class="fc" id="L281">                            asm.invokeStatic(implicitCastDateAsTimestamp);</span>
<span class="fc" id="L282">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L283">                            break;</span>
                        case ColumnType.FLOAT:
<span class="fc" id="L285">                            asm.l2f();</span>
<span class="fc" id="L286">                            asm.invokeInterface(wPutFloat, 2);</span>
<span class="fc" id="L287">                            break;</span>
                        case ColumnType.DOUBLE:
<span class="fc" id="L289">                            asm.l2d();</span>
<span class="fc" id="L290">                            asm.invokeInterface(wPutDouble, 3);</span>
<span class="fc" id="L291">                            break;</span>
                        default:
<span class="nc" id="L293">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.TIMESTAMP:
<span class="fc" id="L298">                    asm.invokeInterface(rGetTimestamp);</span>
<span class="pc bpc" id="L299" title="1 of 9 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.BYTE:
<span class="fc" id="L301">                            asm.invokeStatic(implicitCastLongAsByte);</span>
<span class="fc" id="L302">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L303">                            break;</span>
                        case ColumnType.SHORT:
<span class="fc" id="L305">                            asm.invokeStatic(implicitCastLongAsShort);</span>
<span class="fc" id="L306">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L307">                            break;</span>
                        case ColumnType.INT:
<span class="fc" id="L309">                            asm.invokeStatic(implicitCastLongAsInt);</span>
<span class="fc" id="L310">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L311">                            break;</span>
                        case ColumnType.LONG:
<span class="fc" id="L313">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L314">                            break;</span>
                        case ColumnType.FLOAT:
<span class="fc" id="L316">                            asm.l2f();</span>
<span class="fc" id="L317">                            asm.invokeInterface(wPutFloat, 2);</span>
<span class="fc" id="L318">                            break;</span>
                        case ColumnType.DOUBLE:
<span class="fc" id="L320">                            asm.l2d();</span>
<span class="fc" id="L321">                            asm.invokeInterface(wPutDouble, 3);</span>
<span class="fc" id="L322">                            break;</span>
                        case ColumnType.DATE:
<span class="fc" id="L324">                            asm.invokeInterface(wPutDate, 3);</span>
<span class="fc" id="L325">                            break;</span>
                        case ColumnType.TIMESTAMP:
<span class="fc" id="L327">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L328">                            break;</span>
                        default:
<span class="nc" id="L330">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.BYTE:
<span class="fc" id="L335">                    asm.invokeInterface(rGetByte);</span>
<span class="pc bpc" id="L336" title="1 of 9 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.BYTE:
<span class="fc" id="L338">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L339">                            break;</span>
                        case ColumnType.SHORT:
<span class="fc" id="L341">                            asm.i2s();</span>
<span class="fc" id="L342">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L343">                            break;</span>
                        case ColumnType.INT:
<span class="fc" id="L345">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L346">                            break;</span>
                        case ColumnType.LONG:
<span class="fc" id="L348">                            asm.i2l();</span>
<span class="fc" id="L349">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L350">                            break;</span>
                        case ColumnType.DATE:
<span class="fc" id="L352">                            asm.i2l();</span>
<span class="fc" id="L353">                            asm.invokeInterface(wPutDate, 3);</span>
<span class="fc" id="L354">                            break;</span>
                        case ColumnType.TIMESTAMP:
<span class="fc" id="L356">                            asm.i2l();</span>
<span class="fc" id="L357">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L358">                            break;</span>
                        case ColumnType.FLOAT:
<span class="fc" id="L360">                            asm.i2f();</span>
<span class="fc" id="L361">                            asm.invokeInterface(wPutFloat, 2);</span>
<span class="fc" id="L362">                            break;</span>
                        case ColumnType.DOUBLE:
<span class="fc" id="L364">                            asm.i2d();</span>
<span class="fc" id="L365">                            asm.invokeInterface(wPutDouble, 3);</span>
<span class="fc" id="L366">                            break;</span>
                        default:
<span class="nc" id="L368">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.SHORT:
<span class="fc" id="L373">                    asm.invokeInterface(rGetShort);</span>
<span class="pc bpc" id="L374" title="1 of 9 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.BYTE:
<span class="fc" id="L376">                            asm.invokeStatic(implicitCastShortAsByte);</span>
<span class="fc" id="L377">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L378">                            break;</span>
                        case ColumnType.SHORT:
<span class="fc" id="L380">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L381">                            break;</span>
                        case ColumnType.INT:
<span class="fc" id="L383">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L384">                            break;</span>
                        case ColumnType.LONG:
<span class="fc" id="L386">                            asm.i2l();</span>
<span class="fc" id="L387">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L388">                            break;</span>
                        case ColumnType.DATE:
<span class="fc" id="L390">                            asm.i2l();</span>
<span class="fc" id="L391">                            asm.invokeInterface(wPutDate, 3);</span>
<span class="fc" id="L392">                            break;</span>
                        case ColumnType.TIMESTAMP:
<span class="fc" id="L394">                            asm.i2l();</span>
<span class="fc" id="L395">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L396">                            break;</span>
                        case ColumnType.FLOAT:
<span class="fc" id="L398">                            asm.i2f();</span>
<span class="fc" id="L399">                            asm.invokeInterface(wPutFloat, 2);</span>
<span class="fc" id="L400">                            break;</span>
                        case ColumnType.DOUBLE:
<span class="fc" id="L402">                            asm.i2d();</span>
<span class="fc" id="L403">                            asm.invokeInterface(wPutDouble, 3);</span>
<span class="fc" id="L404">                            break;</span>
                        default:
<span class="nc" id="L406">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.BOOLEAN:
<span class="pc bpc" id="L411" title="1 of 2 branches missed.">                    assert toColumnType == ColumnType.BOOLEAN;</span>
<span class="fc" id="L412">                    asm.invokeInterface(rGetBool);</span>
<span class="fc" id="L413">                    asm.invokeInterface(wPutBool, 2);</span>
<span class="fc" id="L414">                    break;</span>
                case ColumnType.FLOAT:
<span class="fc" id="L416">                    asm.invokeInterface(rGetFloat);</span>
<span class="pc bpc" id="L417" title="1 of 9 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.BYTE:
<span class="fc" id="L419">                            asm.invokeStatic(implicitCastFloatAsByte);</span>
<span class="fc" id="L420">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L421">                            break;</span>
                        case ColumnType.SHORT:
<span class="fc" id="L423">                            asm.invokeStatic(implicitCastFloatAsShort);</span>
<span class="fc" id="L424">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L425">                            break;</span>
                        case ColumnType.INT:
<span class="fc" id="L427">                            asm.invokeStatic(implicitCastFloatAsInt);</span>
<span class="fc" id="L428">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L429">                            break;</span>
                        case ColumnType.LONG:
<span class="fc" id="L431">                            asm.invokeStatic(implicitCastFloatAsLong);</span>
<span class="fc" id="L432">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L433">                            break;</span>
                        case ColumnType.DATE:
<span class="fc" id="L435">                            asm.invokeStatic(implicitCastFloatAsLong);</span>
<span class="fc" id="L436">                            asm.invokeInterface(wPutDate, 3);</span>
<span class="fc" id="L437">                            break;</span>
                        case ColumnType.TIMESTAMP:
<span class="fc" id="L439">                            asm.invokeStatic(implicitCastFloatAsLong);</span>
<span class="fc" id="L440">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L441">                            break;</span>
                        case ColumnType.FLOAT:
<span class="fc" id="L443">                            asm.invokeInterface(wPutFloat, 2);</span>
<span class="fc" id="L444">                            break;</span>
                        case ColumnType.DOUBLE:
<span class="fc" id="L446">                            asm.f2d();</span>
<span class="fc" id="L447">                            asm.invokeInterface(wPutDouble, 3);</span>
<span class="fc" id="L448">                            break;</span>
                        default:
<span class="nc" id="L450">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.DOUBLE:
<span class="fc" id="L455">                    asm.invokeInterface(rGetDouble);</span>
<span class="pc bpc" id="L456" title="1 of 9 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.BYTE:
<span class="fc" id="L458">                            asm.invokeStatic(implicitCastDoubleAsByte);</span>
<span class="fc" id="L459">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L460">                            break;</span>
                        case ColumnType.SHORT:
<span class="fc" id="L462">                            asm.invokeStatic(implicitCastDoubleAsShort);</span>
<span class="fc" id="L463">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L464">                            break;</span>
                        case ColumnType.INT:
<span class="fc" id="L466">                            asm.invokeStatic(implicitCastDoubleAsInt);</span>
<span class="fc" id="L467">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L468">                            break;</span>
                        case ColumnType.LONG:
<span class="fc" id="L470">                            asm.invokeStatic(implicitCastDoubleAsLong);</span>
<span class="fc" id="L471">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L472">                            break;</span>
                        case ColumnType.DATE:
<span class="fc" id="L474">                            asm.invokeStatic(implicitCastDoubleAsLong);</span>
<span class="fc" id="L475">                            asm.invokeInterface(wPutDate, 3);</span>
<span class="fc" id="L476">                            break;</span>
                        case ColumnType.TIMESTAMP:
<span class="fc" id="L478">                            asm.invokeStatic(implicitCastDoubleAsLong);</span>
<span class="fc" id="L479">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L480">                            break;</span>
                        case ColumnType.FLOAT:
<span class="fc" id="L482">                            asm.invokeStatic(implicitCastDoubleAsFloat);</span>
<span class="fc" id="L483">                            asm.invokeInterface(wPutFloat, 2);</span>
<span class="fc" id="L484">                            break;</span>
                        case ColumnType.DOUBLE:
<span class="fc" id="L486">                            asm.invokeInterface(wPutDouble, 3);</span>
<span class="fc" id="L487">                            break;</span>
                        default:
<span class="nc" id="L489">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.CHAR:
<span class="fc" id="L494">                    asm.invokeInterface(rGetChar);</span>
<span class="pc bpc" id="L495" title="1 of 13 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.BYTE:
<span class="fc" id="L497">                            asm.iconst(toColumnType);</span>
<span class="fc" id="L498">                            asm.invokeStatic(implicitCastCharAsByte);</span>
<span class="fc" id="L499">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L500">                            break;</span>
                        case ColumnType.SHORT:
<span class="fc" id="L502">                            asm.iconst(toColumnType);</span>
<span class="fc" id="L503">                            asm.invokeStatic(implicitCastCharAsByte);</span>
<span class="fc" id="L504">                            asm.i2s();</span>
<span class="fc" id="L505">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L506">                            break;</span>
                        case ColumnType.CHAR:
<span class="fc" id="L508">                            asm.invokeInterface(wPutChar, 2);</span>
<span class="fc" id="L509">                            break;</span>
                        case ColumnType.INT:
<span class="fc" id="L511">                            asm.iconst(toColumnType);</span>
<span class="fc" id="L512">                            asm.invokeStatic(implicitCastCharAsByte);</span>
<span class="fc" id="L513">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L514">                            break;</span>
                        case ColumnType.LONG:
<span class="fc" id="L516">                            asm.iconst(toColumnType);</span>
<span class="fc" id="L517">                            asm.invokeStatic(implicitCastCharAsByte);</span>
<span class="fc" id="L518">                            asm.i2l();</span>
<span class="fc" id="L519">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L520">                            break;</span>
                        case ColumnType.DATE:
<span class="fc" id="L522">                            asm.iconst(toColumnType);</span>
<span class="fc" id="L523">                            asm.invokeStatic(implicitCastCharAsByte);</span>
<span class="fc" id="L524">                            asm.i2l();</span>
<span class="fc" id="L525">                            asm.invokeInterface(wPutDate, 3);</span>
<span class="fc" id="L526">                            break;</span>
                        case ColumnType.TIMESTAMP:
<span class="fc" id="L528">                            asm.iconst(toColumnType);</span>
<span class="fc" id="L529">                            asm.invokeStatic(implicitCastCharAsByte);</span>
<span class="fc" id="L530">                            asm.i2l();</span>
<span class="fc" id="L531">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L532">                            break;</span>
                        case ColumnType.FLOAT:
<span class="fc" id="L534">                            asm.iconst(toColumnType);</span>
<span class="fc" id="L535">                            asm.invokeStatic(implicitCastCharAsByte);</span>
<span class="fc" id="L536">                            asm.i2f();</span>
<span class="fc" id="L537">                            asm.invokeInterface(wPutFloat, 2);</span>
<span class="fc" id="L538">                            break;</span>
                        case ColumnType.DOUBLE:
<span class="fc" id="L540">                            asm.iconst(toColumnType);</span>
<span class="fc" id="L541">                            asm.invokeStatic(implicitCastCharAsByte);</span>
<span class="fc" id="L542">                            asm.i2d();</span>
<span class="fc" id="L543">                            asm.invokeInterface(wPutDouble, 3);</span>
<span class="fc" id="L544">                            break;</span>
                        case ColumnType.STRING:
<span class="fc" id="L546">                            asm.invokeInterface(wPutStrChar, 2);</span>
<span class="fc" id="L547">                            break;</span>
                        case ColumnType.SYMBOL:
<span class="fc" id="L549">                            asm.invokeInterface(wPutSymChar, 2);</span>
<span class="fc" id="L550">                            break;</span>
                        case ColumnType.GEOBYTE:
<span class="fc" id="L552">                            asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L553">                            asm.invokeStatic(implicitCastCharAsGeoHash);</span>
<span class="fc" id="L554">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L555">                            break;</span>
                        default:
<span class="nc" id="L557">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.SYMBOL:
<span class="fc" id="L562">                    asm.invokeInterface(rGetSym);</span>
<span class="pc bpc" id="L563" title="1 of 3 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.SYMBOL:
<span class="fc" id="L565">                            asm.invokeInterface(wPutSym, 2);</span>
<span class="fc" id="L566">                            break;</span>
                        case ColumnType.STRING:
<span class="fc" id="L568">                            asm.invokeInterface(wPutStr, 2);</span>
<span class="fc" id="L569">                            break;</span>
                        default:
<span class="nc" id="L571">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.STRING:
                    // This is generic code, and it acts on a record
                    // whereas Functions support string to primitive conversions, Record instances
                    // do not. This is because functions are aware of their return type but records
                    // would have to do expensive checks to decide which conversion would be required
<span class="fc" id="L580">                    asm.invokeInterface(rGetStr);</span>
<span class="pc bpc" id="L581" title="1 of 14 branches missed.">                    switch (toColumnTypeTag) {</span>
                        case ColumnType.BYTE:
<span class="fc" id="L583">                            asm.invokeStatic(implicitCastStrAsByte);</span>
<span class="fc" id="L584">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L585">                            break;</span>
                        case ColumnType.SHORT:
<span class="fc" id="L587">                            asm.invokeStatic(implicitCastStrAsShort);</span>
<span class="fc" id="L588">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L589">                            break;</span>
                        case ColumnType.CHAR:
<span class="fc" id="L591">                            asm.invokeStatic(implicitCastStrAsChar);</span>
<span class="fc" id="L592">                            asm.invokeInterface(wPutChar, 2);</span>
<span class="fc" id="L593">                            break;</span>
                        case ColumnType.INT:
<span class="fc" id="L595">                            asm.invokeStatic(implicitCastStrAsInt);</span>
<span class="fc" id="L596">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L597">                            break;</span>
                        case ColumnType.LONG:
<span class="fc" id="L599">                            asm.invokeStatic(implicitCastStrAsLong);</span>
<span class="fc" id="L600">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L601">                            break;</span>
                        case ColumnType.FLOAT:
<span class="fc" id="L603">                            asm.invokeStatic(implicitCastStrAsFloat);</span>
<span class="fc" id="L604">                            asm.invokeInterface(wPutFloat, 2);</span>
<span class="fc" id="L605">                            break;</span>
                        case ColumnType.DOUBLE:
<span class="fc" id="L607">                            asm.invokeStatic(implicitCastStrAsDouble);</span>
<span class="fc" id="L608">                            asm.invokeInterface(wPutDouble, 3);</span>
<span class="fc" id="L609">                            break;</span>
                        case ColumnType.SYMBOL:
<span class="fc" id="L611">                            asm.invokeInterface(wPutSym, 2);</span>
<span class="fc" id="L612">                            break;</span>
                        case ColumnType.DATE:
<span class="fc" id="L614">                            asm.invokeStatic(implicitCastStrAsDate);</span>
<span class="fc" id="L615">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L616">                            break;</span>
                        case ColumnType.TIMESTAMP:
<span class="fc" id="L618">                            asm.invokeStatic(implicitCastStrAsTimestamp);</span>
<span class="fc" id="L619">                            asm.invokeInterface(wPutTimestamp, 3);</span>
<span class="fc" id="L620">                            break;</span>
                        case ColumnType.GEOBYTE:
                        case ColumnType.GEOSHORT:
                        case ColumnType.GEOINT:
                        case ColumnType.GEOLONG:
<span class="fc" id="L625">                            asm.invokeInterface(wPutGeoStr, 2);</span>
<span class="fc" id="L626">                            break;</span>
                        case ColumnType.STRING:
<span class="fc" id="L628">                            asm.invokeInterface(wPutStr, 2);</span>
<span class="fc" id="L629">                            break;</span>
                        case ColumnType.UUID:
<span class="fc" id="L631">                            asm.invokeInterface(wPutUuidStr, 2);</span>
<span class="fc" id="L632">                            break;</span>
                        default:
<span class="nc" id="L634">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.BINARY:
<span class="pc bpc" id="L639" title="1 of 2 branches missed.">                    assert toColumnTypeTag == ColumnType.BINARY;</span>
<span class="fc" id="L640">                    asm.invokeInterface(rGetBin);</span>
<span class="fc" id="L641">                    asm.invokeInterface(wPutBin, 2);</span>
<span class="fc" id="L642">                    break;</span>
                case ColumnType.LONG256:
<span class="pc bpc" id="L644" title="1 of 2 branches missed.">                    assert toColumnTypeTag == ColumnType.LONG256;</span>
<span class="fc" id="L645">                    asm.invokeInterface(rGetLong256);</span>
<span class="fc" id="L646">                    asm.invokeInterface(wPutLong256, 2);</span>
<span class="fc" id="L647">                    break;</span>
                case ColumnType.GEOBYTE:
<span class="fc" id="L649">                    asm.invokeInterface(rGetGeoByte, 1);</span>
<span class="pc bpc" id="L650" title="1 of 6 branches missed.">                    if (fromColumnType != toColumnType &amp;&amp; (fromColumnType != ColumnType.NULL &amp;&amp; fromColumnType != ColumnType.GEOBYTE)) {</span>
                        // truncate within the same storage type
<span class="fc" id="L652">                        asm.i2l();</span>
<span class="fc" id="L653">                        asm.ldc(fromColumnType_0 + i * 2);</span>
                        // toColumnType
<span class="fc" id="L655">                        asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L656">                        asm.invokeStatic(implicitCastGeoHashAsGeoHash);</span>
<span class="fc" id="L657">                        asm.l2i();</span>
<span class="fc" id="L658">                        asm.i2b();</span>
                    }
<span class="fc" id="L660">                    asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L661">                    break;</span>
                case ColumnType.GEOSHORT:
<span class="fc" id="L663">                    asm.invokeInterface(rGetGeoShort, 1);</span>
<span class="fc bfc" id="L664" title="All 2 branches covered.">                    if (ColumnType.tagOf(toColumnType) == ColumnType.GEOBYTE) {</span>
<span class="fc" id="L665">                        asm.i2l();</span>
<span class="fc" id="L666">                        asm.ldc(fromColumnType_0 + i * 2);</span>
<span class="fc" id="L667">                        asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L668">                        asm.invokeStatic(implicitCastGeoHashAsGeoHash);</span>
<span class="fc" id="L669">                        asm.l2i();</span>
<span class="fc" id="L670">                        asm.i2b();</span>
<span class="fc" id="L671">                        asm.invokeInterface(wPutByte, 2);</span>
<span class="pc bpc" id="L672" title="1 of 6 branches missed.">                    } else if (fromColumnType != toColumnType &amp;&amp; fromColumnType != ColumnType.NULL &amp;&amp; fromColumnType != ColumnType.GEOSHORT) {</span>
<span class="fc" id="L673">                        asm.i2l();</span>
<span class="fc" id="L674">                        asm.ldc(fromColumnType_0 + i * 2);</span>
<span class="fc" id="L675">                        asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L676">                        asm.invokeStatic(implicitCastGeoHashAsGeoHash);</span>
<span class="fc" id="L677">                        asm.l2i();</span>
<span class="fc" id="L678">                        asm.i2s();</span>
<span class="fc" id="L679">                        asm.invokeInterface(wPutShort, 2);</span>
                    } else {
<span class="fc" id="L681">                        asm.invokeInterface(wPutShort, 2);</span>
                    }
<span class="fc" id="L683">                    break;</span>
                case ColumnType.GEOINT:
<span class="fc" id="L685">                    asm.invokeInterface(rGetGeoInt, 1);</span>
<span class="pc bpc" id="L686" title="1 of 4 branches missed.">                    switch (ColumnType.tagOf(toColumnType)) {</span>
                        case ColumnType.GEOBYTE:
<span class="fc" id="L688">                            asm.i2l();</span>
<span class="fc" id="L689">                            asm.ldc(fromColumnType_0 + i * 2);</span>
<span class="fc" id="L690">                            asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L691">                            asm.invokeStatic(implicitCastGeoHashAsGeoHash);</span>
<span class="fc" id="L692">                            asm.l2i();</span>
<span class="fc" id="L693">                            asm.i2b();</span>
<span class="fc" id="L694">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L695">                            break;</span>
                        case ColumnType.GEOSHORT:
<span class="fc" id="L697">                            asm.i2l();</span>
<span class="fc" id="L698">                            asm.ldc(fromColumnType_0 + i * 2);</span>
<span class="fc" id="L699">                            asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L700">                            asm.invokeStatic(implicitCastGeoHashAsGeoHash);</span>
<span class="fc" id="L701">                            asm.l2i();</span>
<span class="fc" id="L702">                            asm.i2s();</span>
<span class="fc" id="L703">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L704">                            break;</span>
                        case ColumnType.GEOINT:
<span class="pc bpc" id="L706" title="1 of 6 branches missed.">                            if (fromColumnType != toColumnType &amp;&amp; fromColumnType != ColumnType.NULL &amp;&amp; fromColumnType != ColumnType.GEOINT) {</span>
<span class="fc" id="L707">                                asm.i2l();</span>
<span class="fc" id="L708">                                asm.ldc(fromColumnType_0 + i * 2);</span>
<span class="fc" id="L709">                                asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L710">                                asm.invokeStatic(implicitCastGeoHashAsGeoHash);</span>
<span class="fc" id="L711">                                asm.l2i();</span>
                            }
<span class="fc" id="L713">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L714">                            break;</span>
                        default:
<span class="nc" id="L716">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.GEOLONG:
<span class="fc" id="L721">                    asm.invokeInterface(rGetGeoLong, 1);</span>
<span class="pc bpc" id="L722" title="1 of 5 branches missed.">                    switch (ColumnType.tagOf(toColumnType)) {</span>
                        case ColumnType.GEOBYTE:
<span class="fc" id="L724">                            asm.ldc(fromColumnType_0 + i * 2);</span>
<span class="fc" id="L725">                            asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L726">                            asm.invokeStatic(implicitCastGeoHashAsGeoHash);</span>
<span class="fc" id="L727">                            asm.l2i();</span>
<span class="fc" id="L728">                            asm.i2b();</span>
<span class="fc" id="L729">                            asm.invokeInterface(wPutByte, 2);</span>
<span class="fc" id="L730">                            break;</span>
                        case ColumnType.GEOSHORT:
<span class="fc" id="L732">                            asm.ldc(fromColumnType_0 + i * 2);</span>
<span class="fc" id="L733">                            asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L734">                            asm.invokeStatic(implicitCastGeoHashAsGeoHash);</span>
<span class="fc" id="L735">                            asm.l2i();</span>
<span class="fc" id="L736">                            asm.i2s();</span>
<span class="fc" id="L737">                            asm.invokeInterface(wPutShort, 2);</span>
<span class="fc" id="L738">                            break;</span>
                        case ColumnType.GEOINT:
<span class="fc" id="L740">                            asm.ldc(fromColumnType_0 + i * 2);</span>
<span class="fc" id="L741">                            asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L742">                            asm.invokeStatic(implicitCastGeoHashAsGeoHash);</span>
<span class="fc" id="L743">                            asm.l2i();</span>
<span class="fc" id="L744">                            asm.invokeInterface(wPutInt, 2);</span>
<span class="fc" id="L745">                            break;</span>
                        case ColumnType.GEOLONG:
<span class="pc bpc" id="L747" title="1 of 6 branches missed.">                            if (fromColumnType != toColumnType &amp;&amp; fromColumnType != ColumnType.NULL &amp;&amp; fromColumnType != ColumnType.GEOLONG) {</span>
<span class="fc" id="L748">                                asm.ldc(fromColumnType_0 + i * 2);</span>
<span class="fc" id="L749">                                asm.ldc(toColumnType_0 + i * 2);</span>
<span class="fc" id="L750">                                asm.invokeStatic(implicitCastGeoHashAsGeoHash);</span>
                            }
<span class="fc" id="L752">                            asm.invokeInterface(wPutLong, 3);</span>
<span class="fc" id="L753">                            break;</span>
                        default:
<span class="nc" id="L755">                            assert false;</span>
                            break;
                    }
                    break;
                case ColumnType.LONG128:
                    // fall through
                case ColumnType.UUID:
<span class="pc bpc" id="L762" title="1 of 3 branches missed.">                    switch (ColumnType.tagOf(toColumnType)) {</span>
                        case ColumnType.LONG128:
                            // fall through
                        case ColumnType.UUID:
                            // Stack: [RowWriter, Record, columnIndex]
<span class="fc" id="L767">                            asm.invokeInterface(rGetLong128Lo, 1);</span>
                            // Stack: [RowWriter, lo]
<span class="fc" id="L769">                            asm.aload(1);  // Push record to the stack.</span>
                            // Stack: [RowWriter, lo, Record]
<span class="fc" id="L771">                            asm.iconst(i); // Push column index to a stack</span>
                            // Stack: [RowWriter, lo, Record, columnIndex]
<span class="fc" id="L773">                            asm.invokeInterface(rGetLong128Hi, 1);</span>
                            // Stack: [RowWriter, lo, hi]
<span class="fc" id="L775">                            asm.invokeInterface(wPutLong128, 5);</span>
                            // invokeInterface consumes the entire stack. Including the RowWriter as invoke interface receives &quot;this&quot; as the first argument
                            // The stack is now empty, and we are done with this column
<span class="fc" id="L778">                            break;</span>
                        case ColumnType.STRING:
<span class="pc bpc" id="L780" title="1 of 2 branches missed.">                            assert fromColumnType == ColumnType.UUID;</span>
                            // this logic is very similar to the one for ColumnType.UUID above
                            // There is one major difference: `SqlUtil.implicitCastUuidAsStr()` returns `false` to indicate
                            // that the UUID value represents null. In this case we won't call the writer and let null value
                            // to be written by TableWriter/WalWriter NullSetters. However, generating branches via asm is
                            // complicated as JVM requires jump targets to have stack maps, etc. This would complicate things
                            // so we rely on an auxiliary method `transferUuidToStrCol()` to do branching job and javac generates
                            // the stack maps.
                            // Stack: [RowWriter, Record, columnIndex]
<span class="fc" id="L789">                            asm.invokeInterface(rGetLong128Lo, 1);</span>
                            // Stack: [RowWriter, lo]
<span class="fc" id="L791">                            asm.aload(1);  // Push record to the stack.</span>
                            // Stack: [RowWriter, lo, Record]
<span class="fc" id="L793">                            asm.iconst(i); // Push column index to a stack</span>
                            // Stack: [RowWriter, lo, Record, columnIndex]
<span class="fc" id="L795">                            asm.invokeInterface(rGetLong128Hi, 1);</span>
                            // Stack: [RowWriter, lo, hi]
<span class="fc" id="L797">                            asm.invokeStatic(transferUuidToStrCol);</span>
<span class="fc" id="L798">                            break;</span>
                        default:
<span class="nc" id="L800">                            assert false;</span>
                            break;
                    }
                    break;
                default:
                    // we don't need to do anything for null as null is already written by TableWriter/WalWriter NullSetters
                    // every non-null-type is an error
<span class="pc bpc" id="L807" title="1 of 2 branches missed.">                    assert fromColumnType == ColumnType.NULL;</span>
            }
        }

<span class="fc" id="L811">        asm.return_();</span>
<span class="fc" id="L812">        asm.endMethodCode();</span>

        // exceptions
<span class="fc" id="L815">        asm.putShort(0);</span>

        // we have do not have to add a stack map table because there are no branches
        // attributes: 0 (void, no branches -&gt; no stack verification)
<span class="fc" id="L819">        asm.putShort(0);</span>

<span class="fc" id="L821">        asm.endMethod();</span>

        // class attribute count
<span class="fc" id="L824">        asm.putShort(0);</span>

<span class="fc" id="L826">        return asm.newInstance();</span>
    }

    // Called from dynamically generated bytecode
    public static void transferUuidToStrCol(TableWriter.Row row, int col, long lo, long hi) {
<span class="fc" id="L831">        StringSink threadLocalBuilder = Misc.getThreadLocalBuilder();</span>
<span class="fc bfc" id="L832" title="All 2 branches covered.">        if (SqlUtil.implicitCastUuidAsStr(lo, hi, threadLocalBuilder)) {</span>
<span class="fc" id="L833">            row.putStr(col, threadLocalBuilder);</span>
        }
<span class="fc" id="L835">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>